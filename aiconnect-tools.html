<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ai-Connect - Tools</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Roboto+Mono:wght@400;700&display=swap">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"> <!-- Font Awesome for tool icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0">

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <style>
    /* --- CSS Variables (EMO Theme) --- */
    :root {
      --emo-bg-dark: #0d0d1a;         
      --emo-panel-dark: #121225;      
      --emo-glass-bg: rgba(18, 18, 37, 0.85); 
      --emo-border: rgba(0, 255, 255, 0.25); 
      --emo-cyan: #00ffff;            
      --emo-cyan-dark: #00cccc;       
      --emo-glow-soft: rgba(0, 255, 255, 0.2);
      --emo-glow-medium: rgba(0, 255, 255, 0.4);
      --emo-glow-strong: rgba(0, 255, 255, 0.7);
      --emo-gold: #ffc107;            
      --emo-gold-glow: rgba(255, 193, 7, 0.6);
      --emo-text-primary: #e0e0f0;    
      --emo-text-secondary: #a0a0c0;  
      --emo-success: #00ff88;         
      --emo-error: #ff4444;           

      --font-display: 'Orbitron', sans-serif;
      --font-data: 'Roboto Mono', monospace;
      --font-body: 'Roboto Mono', monospace;

      --spacing-unit: 15px;
      --border-radius: 8px;
      --border-radius-large: 12px;
      --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      --box-shadow-stronger: 0 5px 15px rgba(0, 0, 0, 0.4);
      --transition-speed: 0.3s;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
        font-family: var(--font-body);
        background-color: var(--emo-bg-dark);
        color: var(--emo-text-primary);
        min-height: 100vh;
        padding-bottom: calc(60px + var(--spacing-unit)); 
        max-width: 420px; /* Mobile-first PWA style */
        margin: 0 auto;
        overflow-x: hidden;
        position: relative;
    }
    a { color: var(--emo-cyan); text-decoration: none; }
    a:hover { color: var(--emo-cyan-dark); text-decoration: underline; text-shadow: 0 0 5px var(--emo-glow-soft); }
    button { font-family: inherit; cursor: pointer; border: none; border-radius: var(--border-radius); transition: background-color var(--transition-speed), transform 0.1s, box-shadow var(--transition-speed); }
    button:active { transform: translateY(1px) scale(0.98); }
    .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24; vertical-align: middle; }
    .fas { vertical-align: middle; } /* For Font Awesome tool icons */

    .primary-button-emo {
        background-color: var(--emo-cyan); color: var(--emo-bg-dark); padding: 10px var(--spacing-unit);
        font-size: 0.9rem; font-weight: 700; text-align: center; font-family: var(--font-display);
        box-shadow: 0 0 10px var(--emo-glow-medium); border-radius: var(--border-radius);
        display: block; width: 100%; margin-top: 10px;
    }
    .primary-button-emo:hover { background-color: var(--emo-cyan-dark); box-shadow: 0 0 15px var(--emo-glow-strong); }
    
    .header {
        background-color: var(--emo-glass-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        color: var(--emo-text-primary); padding: 10px var(--spacing-unit);
        display: flex; align-items: center; justify-content: space-between;
        position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid var(--emo-border);
        height: 56px; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
    }
    .header-logo-container { display: flex; align-items: center; }
    .header-logo-img { width: 30px; height: 30px; object-fit: contain; }
    .header-logo-text {
        font-size: 1.1rem; font-weight: 700; margin-left: 8px; color: var(--emo-cyan);
        font-family: var(--font-display); text-shadow: 0 0 5px var(--emo-glow-soft);
    }
    .header-title-page { 
        font-family: var(--font-display); color: var(--emo-text-secondary); font-size: 0.9rem;
        position: absolute; left: 50%; transform: translateX(-50%);
        opacity: 1; transition: opacity 0.2s ease-in-out;
    }
    .header-title-page.hidden-title { opacity: 0; }
     .header-icons-right { display: flex; align-items: center; gap: calc(var(--spacing-unit) * 0.5); }
    .header-icon { position: relative; cursor: pointer; color: var(--emo-text-secondary); display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 50%; transition: background-color 0.2s, color 0.2s, text-shadow 0.2s; }
    .header-icon:hover { background-color: rgba(0, 255, 255, 0.1); color: var(--emo-cyan); text-shadow: 0 0 8px var(--emo-glow-medium); }


    .main-content-tools { padding: var(--spacing-unit); display: flex; flex-direction: column; gap: var(--spacing-unit); }
    .content-header-tools { margin-bottom: calc(var(--spacing-unit) * 0.5); text-align: center; }
    .content-header-tools h2 { font-family: var(--font-display); font-size: 1.4rem; color: var(--emo-cyan); text-shadow: 0 0 8px var(--emo-glow-medium); margin-bottom: 5px;}
    .content-header-tools p { font-size: 0.85rem; color: var(--emo-text-secondary); }
    

    /* Tool Grid (EMO Theme) */
    .ai-tool-grid-emo { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: var(--spacing-unit); }
    @media (min-width: 380px) { 
        .ai-tool-grid-emo { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); }
    }

    .ai-tool-card-emo {
        background-color: var(--emo-panel-dark);
        border: 1px solid var(--emo-border);
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        display: flex; flex-direction: column; align-items: center; justify-content: space-between;
        padding: calc(var(--spacing-unit) * 0.8);
        cursor: pointer; text-align: center;
        transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
        min-height: 150px; overflow: hidden;
    }
    .ai-tool-card-emo:hover { transform: translateY(-4px); box-shadow: 0 0 15px var(--emo-glow-soft); border-color: var(--emo-cyan); }
    .ai-tool-card-emo .icon-background-emo {
        background-color: rgba(0, 255, 255, 0.08);
        border-radius: 50%; width: 44px; height: 44px;
        display: flex; align-items: center; justify-content: center; margin-bottom: 8px;
        border: 1px solid rgba(0,255,255,0.15);
    }
    .ai-tool-card-emo:hover .icon-background-emo { background-color: rgba(0, 255, 255, 0.15); border-color: rgba(0,255,255,0.3); }
    .ai-tool-card-emo .fas, .ai-tool-card-emo .far, .ai-tool-card-emo .fab { font-size: 20px; color: var(--emo-cyan); text-shadow: 0 0 5px var(--emo-glow-soft); }
    .ai-tool-card-emo h3 {
        font-family: var(--font-display); font-size: 0.85rem; font-weight: 500;
        color: var(--emo-text-primary); margin-bottom: 5px; line-height: 1.3;
        display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;
    }
    .ai-tool-card-emo p.tool-description-emo {
        font-size: 0.7rem; color: var(--emo-text-secondary); line-height: 1.4;
        margin-bottom: 8px; flex-grow: 1;
        display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;
    }
     .ai-tool-card-emo .llm-mix-info {
        font-size: 0.6rem; color: var(--emo-text-secondary); opacity: 0.7;
        margin-top: auto; margin-bottom: 8px; font-style: italic;
        width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .ai-tool-card-emo .btn-launch-emo {
        background-color: transparent; color: var(--emo-cyan); border: 1px solid var(--emo-border);
        padding: 5px 10px; border-radius: 5px; font-size: 0.7rem; font-family: var(--font-display);
        text-transform: uppercase; letter-spacing: 0.5px;
        align-self: stretch; 
    }
    .ai-tool-card-emo:hover .btn-launch-emo { background-color: rgba(0,255,255,0.1); border-color: var(--emo-cyan); }


    /* Active AI Tool View (EMO Theme) */
    #aiToolContentContainerEmo .ai-tool-wrapper-card-emo {
        background-color: var(--emo-panel-dark); border: 1px solid var(--emo-border);
        border-radius: var(--border-radius-large); padding: var(--spacing-unit);
        margin-bottom: var(--spacing-unit); box-shadow: 0 0 15px rgba(0,255,255,0.1);
    }
    #aiToolContentContainerEmo .ai-tool-wrapper-card-emo h3.tool-title-emo { /* Specific class for tool title */
        font-family: var(--font-display); font-size: 1.2rem; color: var(--emo-cyan);
        text-shadow: 0 0 7px var(--emo-glow-medium); margin-bottom: var(--spacing-unit);
    }
    #aiToolContentContainerEmo label {
        display: block; margin-bottom: 5px; font-weight: 500;
        color: var(--emo-text-secondary); font-size: 0.8rem; font-family: var(--font-display);
    }
    #aiToolContentContainerEmo input[type="text"],
    #aiToolContentContainerEmo input[type="number"],
    #aiToolContentContainerEmo input[type="tel"],
    #aiToolContentContainerEmo input[type="file"],
    #aiToolContentContainerEmo textarea,
    #aiToolContentContainerEmo select {
        background-color: rgba(13, 13, 26, 0.7); 
        border: 1px solid var(--emo-border); color: var(--emo-text-primary);
        font-family: var(--font-body); font-size: 0.85rem;
        border-radius: var(--border-radius); padding: 8px 10px; width: 100%;
        margin-bottom: calc(var(--spacing-unit) * 0.8); /* Reduced margin for tighter forms */
        box-shadow: inset 0 0 5px rgba(0,255,255,0.1);
        transition: border-color var(--transition-speed), box-shadow var(--transition-speed);
    }
    #aiToolContentContainerEmo input[type="file"] { padding: 5px; }
    #aiToolContentContainerEmo input:focus, 
    #aiToolContentContainerEmo textarea:focus, 
    #aiToolContentContainerEmo select:focus {
        border-color: var(--emo-cyan); outline: none;
        box-shadow: inset 0 0 8px var(--emo-glow-soft), 0 0 8px var(--emo-glow-soft);
    }
    #aiToolContentContainerEmo .output-emo {
        margin-top: var(--spacing-unit); padding: var(--spacing-unit);
        background-color: rgba(13,13,26,0.5); border: 1px solid var(--emo-border);
        border-radius: var(--border-radius); white-space: pre-wrap; word-wrap: break-word;
        color: var(--emo-text-primary); font-size: 0.8rem; line-height: 1.5; min-height: 80px;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
    }
    #aiToolContentContainerEmo .output-emo img, #aiToolContentContainerEmo img.preview-emo { 
        max-width: 100%; height: auto; border-radius: var(--border-radius); 
        margin-top: 10px; margin-bottom: 10px; border: 1px solid var(--emo-border); 
    }
    #aiToolContentContainerEmo .output-emo audio { width: 100%; margin-top: 10px; filter: invert(1) hue-rotate(180deg) contrast(0.9); } 
    #aiToolContentContainerEmo .spinner-emo {
        border: 3px solid rgba(0, 255, 255, 0.2); width: 30px; height: 30px;
        border-top-color: var(--emo-cyan); border-radius: 50%;
        animation: spin 1s ease infinite; margin: var(--spacing-unit) auto; display: none;
        box-shadow: 0 0 8px var(--emo-glow-soft);
    }
    #aiToolContentContainerEmo .checkbox-group-emo { margin-bottom: var(--spacing-unit); }
    #aiToolContentContainerEmo .checkbox-group-emo label { display: inline-flex; align-items: center; color: var(--emo-text-secondary); font-size: 0.8rem; margin-right: 10px; cursor: pointer; }
    #aiToolContentContainerEmo .checkbox-group-emo input[type="checkbox"] {
        width: auto; margin-right: 5px; accent-color: var(--emo-cyan); 
        vertical-align: middle; box-shadow: none;
    }


    /* API Key Notice EMO Style - Now empty as requested */
    #apiKeyNoticeEmo {
        /* Styles removed, will be an empty div if shown */
        border-radius: var(--border-radius); padding: var(--spacing-unit);
        margin-bottom: var(--spacing-unit);
    }


    #pageLoading {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: rgba(13, 13, 26, 0.95); 
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        z-index: 10001; transition: opacity 0.3s ease, visibility 0s linear 0.3s;
    }
    #pageLoading.hidden { opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0s linear 0s; }
    #pageLoading .loading-text { font-size: 1.1rem; font-weight: 500; color: var(--emo-text-primary); font-family: var(--font-display); }
    #pageLoading .spinner {
        border: 4px solid rgba(0, 255, 255, 0.2); 
        border-top: 4px solid var(--emo-cyan); 
        border-radius: 50%; width: 30px; height: 30px;
        animation: spin 1s linear infinite; margin-bottom: 15px;
        box-shadow: 0 0 10px var(--emo-glow-soft);
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    .bottom-nav {
        background-color: var(--emo-glass-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        border-top: 1px solid var(--emo-border); width: 100%; max-width: 420px; 
        display: flex; justify-content: space-around; align-items: center;
        padding: 5px 0; position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
        z-index: 1000; height: 60px; box-shadow: 0 -3px 15px rgba(0, 0, 0, 0.4);
    }
    .nav-item {
        display: flex; align-items: center; justify-content: center; cursor: pointer;
        color: var(--emo-text-secondary); flex: 1; padding: 10px 0;
        transition: color 0.2s ease, background-color 0.2s ease, transform 0.1s ease, text-shadow 0.2s ease;
        height: 100%; border-radius: var(--border-radius); margin: 0 2px;
    }
    .nav-item.active { color: var(--emo-cyan); text-shadow: 0 0 8px var(--emo-glow-medium); }
    .nav-item:hover:not(.active) { color: var(--emo-cyan); background-color: rgba(0, 255, 255, 0.08); }
    .nav-item:active { transform: scale(0.95); }
    .nav-item .material-symbols-outlined { font-size: 28px; }
    .center-button-nav {
        display: flex; align-items: center; justify-content: center; width: 50px; height: 50px; border-radius: 50%;
        background-color: var(--emo-panel-dark); box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
        margin-top: -20px; cursor: pointer; border: 2px solid var(--emo-border);
        position: relative; flex-shrink: 0;
        transition: transform 0.1s ease, box-shadow 0.2s ease, border-color 0.2s ease;
    }
    .center-button-nav.active { border-color: var(--emo-cyan); box-shadow: 0 0 15px var(--emo-glow-medium); }
    .center-button-nav:hover:not(.active) { box-shadow: 0 0 10px rgba(0, 255, 255, 0.3), 0 0 15px rgba(0, 0, 0, 0.5); }
    .center-button-nav:active { transform: scale(0.95); }
    .center-button-nav img { width: 28px; height: 28px; object-fit: contain; }

  </style>
</head>
<body>

  <div id="pageLoading">
      <div class="spinner"></div>
      <p class="loading-text">ai-Connect</p>
  </div>

  <header class="header">
    <div class="header-logo-container">
      <img src="https://memo.aitekchat.com/assets/logo/logo.png" alt="ai-Connect Logo" class="header-logo-img">
      <span class="header-logo-text">EMX</span>
    </div>
    <div id="pageTitleHeader" class="header-title-page">AI Tools</div> <!-- Default title for dashboard view -->
    <div class="header-icons-right">
      <div id="signOutIcon" class="header-icon" title="Sign Out">
        <span class="material-symbols-outlined">logout</span>
      </div>
    </div>
  </header>

  <main class="main-content-tools">
    <div class="content-header-tools" id="mainContentHeaderAic">
        <h2>ai-Connect Automation Tools</h2>
        <p>Powered by Emilio LLM</p>
    </div>
    
    <div id="dashboardContentAic" class="ai-tool-grid-emo">
         <!-- AI Tool cards will be populated here -->
    </div>

    <div id="aiToolContentContainerEmo" style="display: none;">
         <div class="ai-tool-wrapper-card-emo" id="currentAiToolWrapperEmo">
            <!-- Content for the active AI tool -->
         </div>
    </div>
    <div id="apiKeyNoticeEmo" class="ai-tool-wrapper-card-emo" style="display:none;">
        <!-- Content removed as requested. JS will show/hide this empty div. -->
    </div>
  </main>

<div class="bottom-nav">
  <div class="nav-item" data-target-url="train2earn/emo.html" title="Train to Earn">
    <span class="material-symbols-outlined">psychology</span>
  </div>
  <div class="nav-item" data-target-url="aiconnect-tools.html" title="Tools">
    <span class="material-symbols-outlined">build</span>
  </div>
  <div class="center-button-nav active" data-target-url="index.html" title="Home">
    <img src="https://memo.aitekchat.com/assets/logo/logo.png" alt="Home">
  </div>
  <div class="nav-item" data-target-url="aiconnect-business.html" title="Business Showcase">
    <span class="material-symbols-outlined">school</span>
  </div>
  <div class="nav-item" data-target-url="aiconnect-userprofile.html" title="Profile">
    <span class="material-symbols-outlined">account_circle</span>
  </div>
</div>

  <script>
    // Firebase Config for ai-Connect
    const firebaseConfig = {
        apiKey: "AIzaSyDwldURmtljNpORmpGRacwXriPmQZjF6j8",
        authDomain: "daisy-n7g20a.firebaseapp.com",
        databaseURL: "https://daisy-n7g20a-default-rtdb.firebaseio.com",
        projectId: "daisy-n7g20a",
        storageBucket: "daisy-n7g20a.appspot.com",
        messagingSenderId: "225362605902",
        appId: "1:225362605902:web:d2551cc389e78c92c3d01f"
     };

    if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); } else { firebase.app(); }
    const authAic = firebase.auth();
    const dbAic = firebase.firestore();

    // API Keys
    const TOGETHER_API_KEY = "144f137285e61f4f20c3af158629a0aaee85f131c8a48cd5ffdd0e6477898407"; 
    const DEEPGRAM_API_KEY = "5431a4360985a2cd68978b3b2908c13bca576830"; // Used for STT, TTS, Read
    // const DEEPGRAM_READ_API_KEY = "007d62bf2ec601c1c93b438280c5e0b280b72f70"; // Not strictly needed if DEEPGRAM_API_KEY works for Read
    const GEMINI_API_KEY = "AIzaSyAgh4YT8E-U7AXam1l5h0WaKUb6QkpNwoA"; // Placeholder, not used by current 30 tools
    const YOUTUBE_API_KEY = "AIzaSyBVqdGkOQA_VlhEMooh3vYxblOgFOEgkEc"; // Placeholder, not used by current 30 tools

    // DOM Elements
    const pageLoadingElementAic = document.getElementById('pageLoading');
    const signOutIconAic = document.getElementById('signOutIcon'); 
    const pageTitleHeaderAic = document.getElementById('pageTitleHeader');

    const aiToolContentContainerEmo = document.getElementById('aiToolContentContainerEmo');
    const currentAiToolWrapperEmo = document.getElementById('currentAiToolWrapperEmo');
    const mainContentHeaderAic = document.getElementById('mainContentHeaderAic');
    const dashboardContentAic = document.getElementById('dashboardContentAic');
    const apiKeyNoticeEmo = document.getElementById('apiKeyNoticeEmo');

    function triggerHapticFeedback(type = 'medium') { /* Placeholder for haptic feedback if available */ }

    async function fetchAndDisplayUserDataAic(user) { 
        if (!user) {
            if(pageLoadingElementAic) pageLoadingElementAic.classList.add('hidden');
            window.location.href = 'signin.html';
            return;
        }
        console.log("ai-Connect User:", user.displayName || "Authenticated User");
        if(pageLoadingElementAic) setTimeout(() => pageLoadingElementAic.classList.add('hidden'), 300);
    }

    authAic.onAuthStateChanged((user) => { 
        if (user) {
            fetchAndDisplayUserDataAic(user);
        } else { 
            if(pageLoadingElementAic) pageLoadingElementAic.classList.add('hidden');
            window.location.href = 'signin.html'; 
        }
    });

    if(signOutIconAic) { 
        signOutIconAic.addEventListener('click', async () => { 
            triggerHapticFeedback('heavy');
            if (confirm("Are you sure you want to sign out?")) {
                try {
                    if (pageLoadingElementAic) {
                        pageLoadingElementAic.querySelector('.loading-text').textContent = 'Signing Out...';
                        pageLoadingElementAic.classList.remove('hidden');
                    }
                    await authAic.signOut();
                    // window.location.href = 'signin.html'; // Auth listener will handle redirect
                } catch (error) {
                    console.error("Error signing out: ", error);
                    alert("Sign out failed: " + error.message);
                    if (pageLoadingElementAic) pageLoadingElementAic.classList.add('hidden');
                }
            }
        }); 
    }
    
    document.querySelectorAll('.bottom-nav .nav-item, .bottom-nav .center-button-nav').forEach(item => {
        item.addEventListener('click', () => {
            triggerHapticFeedback();
            const targetUrl = item.dataset.targetUrl;
            if (targetUrl && !item.classList.contains('active')) { window.location.href = targetUrl; }
            else if (item.classList.contains('active')) { 
                if (targetUrl === 'ai-connect-tools.html' && (aiToolContentContainerEmo.style.display === 'block' || dashboardContentAic.style.display === 'none')) {
                    displayAiToolDashboard(); // Go back to tool grid if already on tools page but a tool is active
                } else {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }
        });
    });

    // --- AI API Call Utilities (Adapted for EMO theme) ---
    function showSpinnerEmo(spinnerId) {
        const spinner = currentAiToolWrapperEmo.querySelector(`#${spinnerId}`);
        if (spinner) spinner.style.display = 'block'; else console.warn("Spinner not found:", spinnerId);
    }
    function hideSpinnerEmo(spinnerId) {
        const spinner = currentAiToolWrapperEmo.querySelector(`#${spinnerId}`);
        if (spinner) spinner.style.display = 'none'; else console.warn("Spinner not found for hide:", spinnerId);
    }
    function displayOutputEmo(outputId, data, isHtml = false) {
        const outputElement = currentAiToolWrapperEmo.querySelector(`#${outputId}`);
        if(outputElement) { 
            if (isHtml) outputElement.innerHTML = data; else outputElement.textContent = data; 
            outputElement.style.color = ''; // Reset color
        }
        else console.warn("Output element not found:", outputId);
    }
    function appendOutputEmo(outputId, data, isHtml = false) { // New helper
        const outputElement = currentAiToolWrapperEmo.querySelector(`#${outputId}`);
        if (outputElement) { if (isHtml) outputElement.innerHTML += data; else outputElement.textContent += data; }
         else console.warn("Output element for append not found:", outputId);
    }
    function displayErrorEmo(outputId, error) {
        const outputElement = currentAiToolWrapperEmo.querySelector(`#${outputId}`);
        if(outputElement) { 
            outputElement.innerHTML = `<p style="color: var(--emo-error); margin-top: 5px;">Error: ${error.message || error}</p>`;
        }
        else console.warn("Output element for error not found:", outputId);
    }
    function imagePreview(fileInputId, previewImgId) { // From first file, adapted
        const input = currentAiToolWrapperEmo.querySelector(`#${fileInputId}`);
        const preview = currentAiToolWrapperEmo.querySelector(`#${previewImgId}`);
        if (input && preview && input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function (e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
            }
            reader.readAsDataURL(input.files[0]);
        } else if (preview) {
            preview.src = "#"; // Clear preview
            preview.style.display = 'none';
        }
    }
     function fileToBase64(file) { // From first file
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result); // Keep data:image/... prefix for Together Vision
            reader.onerror = error => reject(error);
        });
    }
    
    // --- Functional API Helper Functions (Adapted from first file) ---
    async function callLlama3FreeEmo(promptContent, spinnerId, outputId, maxTokens = 512, temperature = 0.7) {
        if (!TOGETHER_API_KEY || TOGETHER_API_KEY === "YOUR_TOGETHER_API_KEY_PLACEHOLDER") { 
             displayErrorEmo(outputId, Error("Together API Key not configured.")); if(apiKeyNoticeEmo) apiKeyNoticeEmo.style.display = 'block'; return null; 
        }
        if(apiKeyNoticeEmo) apiKeyNoticeEmo.style.display = 'none'; 
        showSpinnerEmo(spinnerId); displayOutputEmo(outputId, ''); 
        try {
            const response = await fetch("https://api.together.xyz/v1/chat/completions", { method: "POST", headers: { "Authorization": `Bearer ${TOGETHER_API_KEY}`, "Content-Type": "application/json" }, body: JSON.stringify({ model: "meta-llama/Llama-3.3-70B-Instruct-Turbo-Free", messages: [{ role: "user", content: promptContent }], max_tokens: maxTokens, temperature: temperature, stream: false }) });
            if (!response.ok) { const errText = await response.text(); try { const errData = JSON.parse(errText); throw new Error(`Llama3 API Error (${response.status}): ${errData.error?.message || errText}`); } catch (e) { throw new Error(`Llama3 API Error (${response.status}): ${errText}`); } }
            const data = await response.json(); 
            const resultText = data.choices?.[0]?.message?.content?.trim() || "No content received.";
            displayOutputEmo(outputId, resultText);
            return resultText;
        } catch (error) { console.error("Llama 3 Free API EMO call failed:", error); displayErrorEmo(outputId, error); return null; } 
        finally { hideSpinnerEmo(spinnerId); }
    }

    async function callLlamaVisionFreeEmo(imageBase64, promptContent, spinnerId, outputId, previewImgHTML = '', maxTokens = 300) {
        if (!TOGETHER_API_KEY || TOGETHER_API_KEY === "YOUR_TOGETHER_API_KEY_PLACEHOLDER") { displayErrorEmo(outputId, Error("Together API Key not configured.")); if(apiKeyNoticeEmo) apiKeyNoticeEmo.style.display = 'block'; return null;}
        if(apiKeyNoticeEmo) apiKeyNoticeEmo.style.display = 'none'; 
        showSpinnerEmo(spinnerId);
        const outputElement = currentAiToolWrapperEmo.querySelector(`#${outputId}`);
        if (outputElement) outputElement.innerHTML = previewImgHTML; // Show preview first

        try {
            const response = await fetch("https://api.together.xyz/v1/chat/completions", {
                method: "POST",
                headers: { "Authorization": `Bearer ${TOGETHER_API_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: "meta-llama/Llama-Vision-Free", 
                    messages: [{ role: "user", content: [{ type: "image_url", image_url: { url: imageBase64 } }, { type: "text", text: promptContent }] }],
                    max_tokens: maxTokens
                })
            });
            if (!response.ok) { const errData = await response.json(); throw new Error(`API Error (${response.status}): ${errData.error?.message || 'Unknown error'}`); }
            const data = await response.json();
            const resultText = data.choices?.[0]?.message?.content?.trim() || "No description received.";
            
            if (outputElement) {
                const textNode = document.createElement('div');
                textNode.style.marginTop = '10px';
                textNode.textContent = resultText;
                outputElement.appendChild(textNode);
            } else {
                displayOutputEmo(outputId, resultText); // Fallback
            }
            return resultText;
        } catch (error) { console.error("Llama Vision API call failed:", error); displayErrorEmo(outputId, error); return null;} 
        finally { hideSpinnerEmo(spinnerId); }
    }

    async function callFluxImageGeneratorFreeEmo(promptText, spinnerId, outputId, width = 512, height = 512) {
        if (!TOGETHER_API_KEY || TOGETHER_API_KEY === "YOUR_TOGETHER_API_KEY_PLACEHOLDER") { displayErrorEmo(outputId, Error("Together API Key not configured.")); if(apiKeyNoticeEmo) apiKeyNoticeEmo.style.display = 'block'; return null;}
        if(apiKeyNoticeEmo) apiKeyNoticeEmo.style.display = 'none'; 
        showSpinnerEmo(spinnerId);
        const outputElement = currentAiToolWrapperEmo.querySelector(`#${outputId}`);
        if(outputElement) outputElement.innerHTML = '';

        try {
            const response = await fetch("https://api.together.xyz/v1/images/generations", {
                method: "POST",
                headers: { "Authorization": `Bearer ${TOGETHER_API_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: "black-forest-labs/FLUX.1-schnell-Free", 
                    prompt: promptText, width: width, height: height, steps: 4, n: 1, response_format: "b64_json"
                })
            });
            if (!response.ok) { const errData = await response.json(); throw new Error(`API Error (${response.status}): ${errData.error?.message || 'Unknown error'}`); }
            const data = await response.json();
            if (data.data?.[0]?.b64_json && outputElement) {
                const imgElement = document.createElement('img');
                imgElement.src = `data:image/png;base64,${data.data[0].b64_json}`;
                imgElement.alt = promptText;
                outputElement.appendChild(imgElement);
                return imgElement.src;
            } else { displayOutputEmo(outputId, "No image data received."); return null; }
        } catch (error) { console.error("Image Generation API call failed:", error); displayErrorEmo(outputId, error); return null; } 
        finally { hideSpinnerEmo(spinnerId); }
    }
    
    async function callDeepgramSTTEmo(audioFile, spinnerId, outputId) {
        if (!DEEPGRAM_API_KEY || DEEPGRAM_API_KEY === "YOUR_DEEPGRAM_API_KEY") { displayErrorEmo(outputId, Error("Deepgram API Key not configured.")); if(apiKeyNoticeEmo) apiKeyNoticeEmo.style.display = 'block'; return null;}
        if(apiKeyNoticeEmo) apiKeyNoticeEmo.style.display = 'none'; 
        showSpinnerEmo(spinnerId); displayOutputEmo(outputId, '');

        try {
            const response = await fetch("https://api.deepgram.com/v1/listen?smart_format=true&punctuate=true¶graphs=true&model=nova-2", {
                method: "POST", headers: { "Authorization": `Token ${DEEPGRAM_API_KEY}` }, body: audioFile
            });
            if (!response.ok) { const errData = await response.json(); throw new Error(`API Error (${response.status}): ${errData.err_msg || errData.reason || 'Unknown error'}`); }
            const data = await response.json();
            const transcript = data.results?.channels[0]?.alternatives[0]?.transcript || "No transcript found.";
            displayOutputEmo(outputId, transcript);
            return transcript; 
        } catch (error) { console.error("Deepgram STT API call failed:", error); displayErrorEmo(outputId, error); return null; } 
        finally { hideSpinnerEmo(spinnerId); }
    }

    async function callDeepgramTTSEmo(text, spinnerId, outputId) {
         if (!DEEPGRAM_API_KEY || DEEPGRAM_API_KEY === "YOUR_DEEPGRAM_API_KEY") { displayErrorEmo(outputId, Error("Deepgram API Key not configured.")); if(apiKeyNoticeEmo) apiKeyNoticeEmo.style.display = 'block'; return null;}
        if(apiKeyNoticeEmo) apiKeyNoticeEmo.style.display = 'none'; 
        showSpinnerEmo(spinnerId);
        const outputElement = currentAiToolWrapperEmo.querySelector(`#${outputId}`);
        if (outputElement) outputElement.innerHTML = '';

        try {
            const response = await fetch("https://api.deepgram.com/v1/speak?model=aura-asteria-en", {
                method: "POST", headers: { "Authorization": `Token ${DEEPGRAM_API_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({ text: text })
            });
            if (!response.ok) { 
                let errorMsg = 'Unknown TTS error';
                try { const errorData = await response.json(); errorMsg = errorData.err_msg || errorData.reason || JSON.stringify(errorData); }
                catch(e) { errorMsg = await response.text(); }
                throw new Error(`API Error (${response.status}): ${errorMsg}`);
            }
            const audioBlob = await response.blob();
            const audioUrl = URL.createObjectURL(audioBlob);
            const audioElement = document.createElement('audio');
            audioElement.controls = true; audioElement.src = audioUrl;
            if (outputElement) outputElement.appendChild(audioElement);
            return audioUrl;
        } catch (error) { console.error("Deepgram TTS API call failed:", error); displayErrorEmo(outputId, error); return null;} 
        finally { hideSpinnerEmo(spinnerId); }
    }
    
    async function callDeepgramReadEmo(text, features, spinnerId, outputId) {
        if (!DEEPGRAM_API_KEY || DEEPGRAM_API_KEY === "YOUR_DEEPGRAM_API_KEY") { displayErrorEmo(outputId, Error("Deepgram API Key not configured.")); if(apiKeyNoticeEmo) apiKeyNoticeEmo.style.display = 'block'; return null;}
        if(apiKeyNoticeEmo) apiKeyNoticeEmo.style.display = 'none'; 
        showSpinnerEmo(spinnerId); displayOutputEmo(outputId, '');

        let queryParams = Object.entries(features)
            .map(([key, value]) => value === true ? `${key === 'summarize' ? 'summarize=v2' : key + '=true'}&` : "")
            .join('') + "language=en";

        try {
            const response = await fetch(`https://api.deepgram.com/v1/read?${queryParams}`, {
                method: "POST", headers: { "Authorization": `Token ${DEEPGRAM_API_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({ text: text })
            });
            if (!response.ok) { const errData = await response.json(); throw new Error(`API Error (${response.status}): ${errData.err_msg || errData.reason || 'Unknown error'}`); }
            const data = await response.json();
            displayOutputEmo(outputId, JSON.stringify(data.results, null, 2));
            return data.results;
        } catch (error) { console.error("Deepgram Read API call failed:", error); displayErrorEmo(outputId, error); return null; } 
        finally { hideSpinnerEmo(spinnerId); }
    }
    
    // Placeholder API calls from original second file (not used by the 30 tools)
    async function callGeminiAPI(promptContent, spinnerId, outputId) { /* Assumed adapted placeholder */ displayOutputEmo(outputId, `Gemini (Sim) Result for: ${promptContent.substring(0,30)}...`); return `Gemini (Sim) Result for: ${promptContent.substring(0,30)}...`;}
    async function callYouTubeSearchAPI(query, spinnerId, outputId, maxResults = 2) { /* Assumed adapted placeholder */ displayOutputEmo(outputId, `YT Search (Sim) for: ${query}`); return { items: [{id:{videoId:"sim1"}, snippet:{title:"Sim YT Video 1: "+query}}, {id:{videoId:"sim2"}, snippet:{title:"Sim YT Video 2: "+query}}] };}


    // --- AI Tool Definitions (30 total from first file, adapted for EMO) ---
    const aiToolsDefinitionsAic = [
        {
            id: 'blogIdeaGenerator', title: 'Blog Idea Generator', icon: 'fas fa-lightbulb',
            description: 'Generates blog post titles and concepts from a topic.', llmMix: "Llama-3",
            html: () => `
                <h3 class="tool-title-emo">Blog Post Idea Generator</h3>
                <label for="blogTopic_aic">Enter a keyword or topic:</label>
                <input type="text" id="blogTopic_aic" placeholder="e.g., Sustainable Living">
                <button onclick="aicTool_generateBlogIdeas()" class="primary-button-emo">Generate Ideas</button>
                <div class="spinner-emo" id="blogIdeaSpinner_aic"></div>
                <div class="output-emo" id="blogIdeaOutput_aic"></div>`,
            action: async function aicTool_generateBlogIdeas() {
                const topic = currentAiToolWrapperEmo.querySelector('#blogTopic_aic').value;
                if (!topic) { alert("Please enter a topic."); return; }
                const prompt = `Generate 5 engaging blog post titles and a brief (1-2 sentence) concept for each, based on the topic: "${topic}". Format as a numbered list. Title: [Title] - Concept: [Concept]`;
                await callLlama3FreeEmo(prompt, 'blogIdeaSpinner_aic', 'blogIdeaOutput_aic');
            }
        },
        {
            id: 'captionWriter', title: 'Social Media Caption Writer', icon: 'fas fa-share-square',
            description: 'Creates social media captions for various platforms.', llmMix: "Llama-3",
            html: () => `
                <h3 class="tool-title-emo">Social Media Caption Writer</h3>
                <label for="captionTopic_aic">Brief description or topic:</label>
                <input type="text" id="captionTopic_aic" placeholder="e.g., My new travel photo">
                <label for="captionPlatform_aic">Platform:</label>
                <select id="captionPlatform_aic">
                    <option value="Instagram">Instagram</option> <option value="Twitter (X)">Twitter (X)</option> <option value="LinkedIn">LinkedIn</option> <option value="Facebook">Facebook</option>
                </select>
                <button onclick="aicTool_generateCaptions()" class="primary-button-emo">Generate Captions</button>
                <div class="spinner-emo" id="captionSpinner_aic"></div>
                <div class="output-emo" id="captionOutput_aic"></div>`,
            action: async function aicTool_generateCaptions() {
                const topic = currentAiToolWrapperEmo.querySelector('#captionTopic_aic').value;
                const platform = currentAiToolWrapperEmo.querySelector('#captionPlatform_aic').value;
                if (!topic) { alert("Please enter a topic."); return; }
                const prompt = `Write 3 social media captions for ${platform} based on the topic: "${topic}". Include relevant emojis and suggest 2-3 hashtags for each. Make them engaging and suitable for the platform.`;
                await callLlama3FreeEmo(prompt, 'captionSpinner_aic', 'captionOutput_aic');
            }
        },
        {
            id: 'hookCreator', title: 'Video Script Hook Creator', icon: 'fas fa-film',
            description: 'Generates attention-grabbing hooks for video scripts.', llmMix: "Llama-3",
            html: () => `
                <h3 class="tool-title-emo">Video Script Hook Creator</h3>
                <label for="hookTopic_aic">Video topic:</label>
                <input type="text" id="hookTopic_aic" placeholder="e.g., 10 productivity hacks">
                <button onclick="aicTool_generateHooks()" class="primary-button-emo">Generate Hooks</button>
                <div class="spinner-emo" id="hookSpinner_aic"></div>
                <div class="output-emo" id="hookOutput_aic"></div>`,
            action: async function aicTool_generateHooks() {
                const topic = currentAiToolWrapperEmo.querySelector('#hookTopic_aic').value;
                if (!topic) { alert("Please enter a video topic."); return; }
                const prompt = `Generate 3-5 compelling opening hooks (1-2 sentences each) for a video about "${topic}". These hooks should grab the viewer's attention immediately.`;
                await callLlama3FreeEmo(prompt, 'hookSpinner_aic', 'hookOutput_aic');
            }
        },
        {
            id: 'promptEnhancer', title: 'Image Prompt Enhancer', icon: 'fas fa-magic',
            description: 'Enhances simple image prompts for better AI image generation.', llmMix: "Llama-3",
            html: () => `
                <h3 class="tool-title-emo">Image Prompt Enhancer</h3>
                <label for="simplePrompt_aic">Enter your simple image prompt:</label>
                <input type="text" id="simplePrompt_aic" placeholder="e.g., cat on a roof">
                <button onclick="aicTool_enhancePrompt()" class="primary-button-emo">Enhance Prompt</button>
                <div class="spinner-emo" id="promptEnhancerSpinner_aic"></div>
                <div class="output-emo" id="promptEnhancerOutput_aic"></div>`,
            action: async function aicTool_enhancePrompt() {
                const simplePrompt = currentAiToolWrapperEmo.querySelector('#simplePrompt_aic').value;
                if (!simplePrompt) { alert("Please enter a simple prompt."); return; }
                const prompt = `Given the simple image generation prompt: "${simplePrompt}", enhance it to be more descriptive and likely to produce a better image. Provide 3 variations. Focus on adding details about style, lighting, composition, and mood.`;
                await callLlama3FreeEmo(prompt, 'promptEnhancerSpinner_aic', 'promptEnhancerOutput_aic');
            }
        },
        {
            id: 'imageDescriber', title: 'Image Describer', icon: 'far fa-eye',
            description: 'Describes the content of an uploaded image.', llmMix: "Llama-Vision",
            html: () => `
                <h3 class="tool-title-emo">Image Describer</h3>
                <label for="imageToDescribe_aic">Upload an image:</label>
                <input type="file" id="imageToDescribe_aic" accept="image/*" onchange="imagePreview('imageToDescribe_aic', 'imageDescriberPreview_aic')">
                <img id="imageDescriberPreview_aic" src="#" alt="Image preview" class="preview-emo" style="display:none; max-width: 200px;"/>
                <button onclick="aicTool_describeImage()" class="primary-button-emo">Describe Image</button>
                <div class="spinner-emo" id="imageDescriberSpinner_aic"></div>
                <div class="output-emo" id="imageDescriberOutput_aic"></div>`,
            action: async function aicTool_describeImage() {
                const fileInput = currentAiToolWrapperEmo.querySelector('#imageToDescribe_aic');
                if (!fileInput.files.length) { alert("Please upload an image."); return; }
                const imageFile = fileInput.files[0];
                const imageBase64 = await fileToBase64(imageFile);
                const prompt = "Describe this image in detail. What are the main objects, setting, colors, and any notable features?";
                const previewImgHTML = currentAiToolWrapperEmo.querySelector('#imageDescriberPreview_aic').outerHTML;
                await callLlamaVisionFreeEmo(imageBase64, prompt, 'imageDescriberSpinner_aic', 'imageDescriberOutput_aic', previewImgHTML);
            }
        },
        {
            id: 'imageGenerator', title: 'Simple Image Generator', icon: 'far fa-image',
            description: 'Generates images from text prompts using FLUX.1 model.', llmMix: "FLUX.1",
            html: () => `
                <h3 class="tool-title-emo">Simple Image Generator</h3>
                <label for="imageGenPrompt_aic">Enter your image prompt:</label>
                <input type="text" id="imageGenPrompt_aic" placeholder="e.g., A futuristic cityscape at sunset">
                <button onclick="aicTool_generateImage()" class="primary-button-emo">Generate Image</button>
                <div class="spinner-emo" id="imageGeneratorSpinner_aic"></div>
                <div class="output-emo" id="imageGeneratorOutput_aic"></div>`,
            action: async function aicTool_generateImage() {
                const prompt = currentAiToolWrapperEmo.querySelector('#imageGenPrompt_aic').value;
                if (!prompt) { alert("Please enter an image prompt."); return; }
                await callFluxImageGeneratorFreeEmo(prompt, 'imageGeneratorSpinner_aic', 'imageGeneratorOutput_aic');
            }
        },
        {
            id: 'podcastTitleSuggester', title: 'Podcast Title Suggester', icon: 'fas fa-podcast',
            description: 'Suggests creative titles for podcast episodes based on topic.', llmMix: "Llama-3",
            html: () => `
                <h3 class="tool-title-emo">Podcast Episode Title Suggester</h3>
                <label for="podcastTopic_aic">Episode topic or summary:</label>
                <input type="text" id="podcastTopic_aic" placeholder="e.g., Interview with a tech innovator">
                <button onclick="aicTool_suggestPodcastTitles()" class="primary-button-emo">Suggest Titles</button>
                <div class="spinner-emo" id="podcastTitleSpinner_aic"></div>
                <div class="output-emo" id="podcastTitleOutput_aic"></div>`,
            action: async function aicTool_suggestPodcastTitles() {
                const topic = currentAiToolWrapperEmo.querySelector('#podcastTopic_aic').value;
                if (!topic) { alert("Please enter a podcast topic or summary."); return; }
                const prompt = `Generate 5 creative and engaging podcast episode titles for a show about: "${topic}".`;
                await callLlama3FreeEmo(prompt, 'podcastTitleSpinner_aic', 'podcastTitleOutput_aic');
            }
        },
        {
            id: 'emailSubjectGenerator', title: 'Email Subject Generator', icon: 'fas fa-envelope-open-text',
            description: 'Generates compelling email subject lines for high open rates.', llmMix: "Llama-3",
             html: () => `
                <h3 class="tool-title-emo">Email Subject Line Generator</h3>
                <label for="emailContentSummary_aic">Email content summary or goal:</label>
                <input type="text" id="emailContentSummary_aic" placeholder="e.g., Announcing new product feature">
                <button onclick="aicTool_generateEmailSubjects()" class="primary-button-emo">Generate Subjects</button>
                <div class="spinner-emo" id="emailSubjectSpinner_aic"></div>
                <div class="output-emo" id="emailSubjectOutput_aic"></div>`,
            action: async function aicTool_generateEmailSubjects() {
                const summary = currentAiToolWrapperEmo.querySelector('#emailContentSummary_aic').value;
                if (!summary) { alert("Please enter an email content summary or goal."); return; }
                const prompt = `Generate 5 compelling email subject lines for an email with the following content/goal: "${summary}". Aim for high open rates.`;
                await callLlama3FreeEmo(prompt, 'emailSubjectSpinner_aic', 'emailSubjectOutput_aic');
            }
        },
        {
            id: 'audioTranscriber', title: 'Audio Note Transcriber', icon: 'fas fa-file-audio',
            description: 'Transcribes uploaded audio files into text using Deepgram.', llmMix: "Deepgram STT",
            html: () => `
                <h3 class="tool-title-emo">Audio Note Transcriber</h3>
                <label for="audioToTranscribe_aic">Upload an audio file (WAV, MP3, etc.):</label>
                <input type="file" id="audioToTranscribe_aic" accept="audio/*">
                <button onclick="aicTool_transcribeAudio()" class="primary-button-emo">Transcribe Audio</button>
                <div class="spinner-emo" id="audioTranscriberSpinner_aic"></div>
                <div class="output-emo" id="audioTranscriberOutput_aic"></div>`,
            action: async function aicTool_transcribeAudio() {
                const fileInput = currentAiToolWrapperEmo.querySelector('#audioToTranscribe_aic');
                if (!fileInput.files.length) { alert("Please upload an audio file."); return; }
                await callDeepgramSTTEmo(fileInput.files[0], 'audioTranscriberSpinner_aic', 'audioTranscriberOutput_aic');
            }
        },
        {
            id: 'ttsAnnouncer', title: 'Text-to-Speech Announcer', icon: 'fas fa-bullhorn',
            description: 'Converts text into speech using Deepgram TTS.', llmMix: "Deepgram TTS",
            html: () => `
                <h3 class="tool-title-emo">Text-to-Speech Announcer</h3>
                <label for="textToSpeak_aic">Enter text to convert to speech:</label>
                <textarea id="textToSpeak_aic" rows="3" placeholder="Hello, this is a test of text to speech."></textarea>
                <button onclick="aicTool_speakText()" class="primary-button-emo">Speak Text</button>
                <div class="spinner-emo" id="ttsAnnouncerSpinner_aic"></div>
                <div class="output-emo" id="ttsAnnouncerOutput_aic"></div>`,
            action: async function aicTool_speakText() {
                const text = currentAiToolWrapperEmo.querySelector('#textToSpeak_aic').value;
                if (!text) { alert("Please enter text to speak."); return; }
                await callDeepgramTTSEmo(text, 'ttsAnnouncerSpinner_aic', 'ttsAnnouncerOutput_aic');
            }
        },
        {
            id: 'sceneSummarizer', title: 'Video Script Scene Summarizer', icon: 'fas fa-align-left',
            description: 'Summarizes video script scenes, focusing on key actions.', llmMix: "Llama-3",
            html: () => `
                <h3 class="tool-title-emo">Video Script Scene Summarizer</h3>
                <label for="scriptScene_aic">Paste script scene:</label>
                <textarea id="scriptScene_aic" rows="5" placeholder="INT. COFFEE SHOP - DAY..."></textarea>
                <button onclick="aicTool_summarizeScene()" class="primary-button-emo">Summarize Scene</button>
                <div class="spinner-emo" id="sceneSummarizerSpinner_aic"></div>
                <div class="output-emo" id="sceneSummarizerOutput_aic"></div>`,
            action: async function aicTool_summarizeScene() {
                const sceneText = currentAiToolWrapperEmo.querySelector('#scriptScene_aic').value;
                if (!sceneText) { alert("Please paste a script scene."); return; }
                const prompt = `Summarize the following video script scene in 1-2 sentences, focusing on the key actions and dialogue points:\n\n${sceneText}`;
                await callLlama3FreeEmo(prompt, 'sceneSummarizerSpinner_aic', 'sceneSummarizerOutput_aic');
            }
        },
        {
            id: 'audioSentimentChecker', title: 'Audio Sentiment Checker', icon: 'fas fa-smile-beam', // Font Awesome solid
            description: 'Checks sentiment of uploaded audio (transcript + analysis).', llmMix: "Deepgram STT + Read",
            html: () => `
                <h3 class="tool-title-emo">Simple Audio Sentiment Checker</h3>
                <label for="audioForSentiment_aic">Upload audio for sentiment analysis:</label>
                <input type="file" id="audioForSentiment_aic" accept="audio/*">
                <button onclick="aicTool_checkAudioSentiment()" class="primary-button-emo">Check Sentiment</button>
                <div class="spinner-emo" id="audioSentimentSpinner_aic"></div>
                <div class="output-emo" id="audioSentimentOutput_aic"></div>`,
            action: async function aicTool_checkAudioSentiment() {
                const fileInput = currentAiToolWrapperEmo.querySelector('#audioForSentiment_aic');
                if (!fileInput.files.length) { alert("Please upload an audio file."); return; }
                const transcript = await callDeepgramSTTEmo(fileInput.files[0], 'audioSentimentSpinner_aic', 'audioSentimentOutput_aic'); 
                if (transcript) {
                    await callDeepgramReadEmo(transcript, { sentiment: true }, 'audioSentimentSpinner_aic', 'audioSentimentOutput_aic');
                } else {
                    hideSpinnerEmo('audioSentimentSpinner_aic'); 
                }
            }
        },
        {
            id: 'audioTopicExtractor', title: 'Key Topics from Audio', icon: 'fas fa-tags',
            description: 'Extracts key topics from uploaded audio.', llmMix: "Deepgram STT + Read",
            html: () => `
                <h3 class="tool-title-emo">Key Topics from Audio Extractor</h3>
                <label for="audioForTopics_aic">Upload audio to extract topics:</label>
                <input type="file" id="audioForTopics_aic" accept="audio/*">
                <button onclick="aicTool_extractAudioTopics()" class="primary-button-emo">Extract Topics</button>
                <div class="spinner-emo" id="audioTopicSpinner_aic"></div>
                <div class="output-emo" id="audioTopicOutput_aic"></div>`,
            action: async function aicTool_extractAudioTopics() {
                const fileInput = currentAiToolWrapperEmo.querySelector('#audioForTopics_aic');
                if (!fileInput.files.length) { alert("Please upload an audio file."); return; }
                const transcript = await callDeepgramSTTEmo(fileInput.files[0], 'audioTopicSpinner_aic', 'audioTopicOutput_aic');
                if (transcript) {
                    await callDeepgramReadEmo(transcript, { topics: true }, 'audioTopicSpinner_aic', 'audioTopicOutput_aic');
                } else {
                    hideSpinnerEmo('audioTopicSpinner_aic');
                }
            }
        },
         {
            id: 'paraphraser', title: 'Content Paraphraser', icon: 'fas fa-random',
            description: 'Paraphrases text while maintaining original meaning.', llmMix: "Llama-3",
            html: () => `
                <h3 class="tool-title-emo">Content Paraphraser</h3>
                <label for="textToParaphrase_aic">Paste text to paraphrase:</label>
                <textarea id="textToParaphrase_aic" rows="5" placeholder="The quick brown fox jumps over the lazy dog."></textarea>
                <button onclick="aicTool_paraphraseText()" class="primary-button-emo">Paraphrase</button>
                <div class="spinner-emo" id="paraphraserSpinner_aic"></div>
                <div class="output-emo" id="paraphraserOutput_aic"></div>`,
            action: async function aicTool_paraphraseText() {
                const text = currentAiToolWrapperEmo.querySelector('#textToParaphrase_aic').value;
                if (!text) { alert("Please enter text to paraphrase."); return; }
                const prompt = `Paraphrase the following text, maintaining its original meaning but using different wording and sentence structure:\n\n${text}`;
                await callLlama3FreeEmo(prompt, 'paraphraserSpinner_aic', 'paraphraserOutput_aic');
            }
        },
        {
            id: 'textSummarizer', title: 'Text Summarizer', icon: 'fas fa-compress-arrows-alt',
            description: 'Summarizes short pieces of text concisely.', llmMix: "Llama-3",
            html: () => `
                <h3 class="tool-title-emo">Text Summarizer (Short Text)</h3>
                <label for="textToSummarize_aic">Paste text to summarize (a few paragraphs):</label>
                <textarea id="textToSummarize_aic" rows="7" placeholder="Enter your text here..."></textarea>
                <button onclick="aicTool_summarizeShortText()" class="primary-button-emo">Summarize Text</button>
                <div class="spinner-emo" id="textSummarizerSpinner_aic"></div>
                <div class="output-emo" id="textSummarizerOutput_aic"></div>`,
            action: async function aicTool_summarizeShortText() {
                const text = currentAiToolWrapperEmo.querySelector('#textToSummarize_aic').value;
                if (!text) { alert("Please enter text to summarize."); return; }
                const prompt = `Summarize the following text concisely (around 2-3 sentences or a short paragraph if the text is longer):\n\n${text}`;
                await callLlama3FreeEmo(prompt, 'textSummarizerSpinner_aic', 'textSummarizerOutput_aic');
            }
        },
        {
            id: 'grammarToneChecker', title: 'Grammar & Tone Check', icon: 'fas fa-spell-check',
            description: 'Checks text for grammar errors and assesses its tone.', llmMix: "Llama-3",
            html: () => `
                <h3 class="tool-title-emo">Grammar & Tone Quick Check</h3>
                <label for="textForGrammarTone_aic">Paste text for grammar & tone check:</label>
                <textarea id="textForGrammarTone_aic" rows="5" placeholder="Their going to the park. Its a beautiful day!"></textarea>
                <button onclick="aicTool_checkGrammarTone()" class="primary-button-emo">Check Text</button>
                <div class="spinner-emo" id="grammarToneSpinner_aic"></div>
                <div class="output-emo" id="grammarToneOutput_aic"></div>`,
            action: async function aicTool_checkGrammarTone() {
                const text = currentAiToolWrapperEmo.querySelector('#textForGrammarTone_aic').value;
                if (!text) { alert("Please enter text to check."); return; }
                const prompt = `Analyze the following text for grammar errors and assess its overall tone. Provide corrections for grammar and suggest if the tone is (e.g., formal, informal, friendly, assertive, etc.). If there are errors, list them and provide corrected versions. Text:\n\n"${text}"`;
                await callLlama3FreeEmo(prompt, 'grammarToneSpinner_aic', 'grammarToneOutput_aic');
            }
        },
        {
            id: 'altTextGenerator', title: 'Image Alt-Text Generator', icon: 'fas fa-closed-captioning',
            description: 'Generates descriptive alt-text for images.', llmMix: "Llama-Vision + Llama-3",
            html: () => `
                <h3 class="tool-title-emo">Image Alt-Text Generator</h3>
                <label for="imageForAltText_aic">Upload image for alt-text:</label>
                <input type="file" id="imageForAltText_aic" accept="image/*" onchange="imagePreview('imageForAltText_aic', 'altTextPreview_aic')">
                <img id="altTextPreview_aic" src="#" alt="Image preview" class="preview-emo" style="display:none; max-width: 200px;"/>
                <button onclick="aicTool_generateAltText()" class="primary-button-emo">Generate Alt-Text</button>
                <div class="spinner-emo" id="altTextSpinner_aic"></div>
                <div class="output-emo" id="altTextOutput_aic"></div>`,
            action: async function aicTool_generateAltText() {
                const fileInput = currentAiToolWrapperEmo.querySelector('#imageForAltText_aic');
                if (!fileInput.files.length) { alert("Please upload an image."); return; }
                const imageFile = fileInput.files[0];
                const imageBase64 = await fileToBase64(imageFile);
                const previewImgHTML = currentAiToolWrapperEmo.querySelector('#altTextPreview_aic').outerHTML;
                
                showSpinnerEmo('altTextSpinner_aic');
                const outputElement = currentAiToolWrapperEmo.querySelector('#altTextOutput_aic');
                if(outputElement) outputElement.innerHTML = previewImgHTML;

                try {
                    const visionResult = await callLlamaVisionFreeEmo(imageBase64, "Briefly describe this image for alt text.", 'altTextSpinner_aic', 'altTextOutput_aic', '', 100); // Call Llama Vision directly
                    if (visionResult && typeof visionResult === 'string') { // Ensure it's the text, not the full response object
                         const altTextPrompt = `Convert the following image description into concise and effective alt text: "${visionResult}"`;
                         const altText = await callLlama3FreeEmo(altTextPrompt, 'altTextSpinner_aic', 'altTextOutput_aic', 50); // Llama3FreeEmo updates the output
                         if (altText && outputElement) {
                            const textNode = document.createElement('div'); 
                            textNode.style.marginTop = '10px';
                            textNode.textContent = altText; 
                            // Check if output already contains the image, if so append, else replace
                            if (outputElement.querySelector('img')) outputElement.appendChild(textNode);
                            else outputElement.innerHTML = previewImgHTML + textNode.outerHTML;
                         } else if (outputElement) {
                            const textNode = document.createElement('div'); textNode.textContent = visionResult; outputElement.appendChild(textNode);
                         }
                    } else if (outputElement) {
                         displayErrorEmo('altTextOutput_aic', Error("Could not get image description from Vision API."));
                    }
                } catch (error) { console.error("Alt-text generation failed:", error); displayErrorEmo('altTextOutput_aic', error); } 
                finally { hideSpinnerEmo('altTextSpinner_aic'); }
            }
        },
        {
            id: 'keywordExtractor', title: 'Keyword Extractor', icon: 'fas fa-key',
            description: 'Extracts main keywords and key phrases from text.', llmMix: "Llama-3",
            html: () => `
                <h3 class="tool-title-emo">Keyword Extractor from Text</h3>
                <label for="textForKeywords_aic">Paste text to extract keywords:</label>
                <textarea id="textForKeywords_aic" rows="5" placeholder="Artificial intelligence is transforming various industries..."></textarea>
                <button onclick="aicTool_extractKeywords()" class="primary-button-emo">Extract Keywords</button>
                <div class="spinner-emo" id="keywordExtractorSpinner_aic"></div>
                <div class="output-emo" id="keywordExtractorOutput_aic"></div>`,
            action: async function aicTool_extractKeywords() {
                const text = currentAiToolWrapperEmo.querySelector('#textForKeywords_aic').value;
                if (!text) { alert("Please enter text to extract keywords from."); return; }
                const prompt = `Extract the main keywords and key phrases (up to 10) from the following text. List them clearly:\n\n${text}`;
                await callLlama3FreeEmo(prompt, 'keywordExtractorSpinner_aic', 'keywordExtractorOutput_aic');
            }
        },
        {
            id: 'readabilityEstimator', title: 'Readability Estimator', icon: 'fas fa-glasses',
            description: 'Estimates text readability using Flesch-Kincaid Grade Level.', llmMix: "Llama-3",
            html: () => `
                <h3 class="tool-title-emo">Content Readability Score Estimator</h3>
                <label for="textForReadability_aic">Paste text to estimate readability:</label>
                <textarea id="textForReadability_aic" rows="5" placeholder="Enter text to analyze its complexity..."></textarea>
                <button onclick="aicTool_estimateReadability()" class="primary-button-emo">Estimate Readability</button>
                <div class="spinner-emo" id="readabilitySpinner_aic"></div>
                <div class="output-emo" id="readabilityOutput_aic"></div>`,
            action: async function aicTool_estimateReadability() {
                const text = currentAiToolWrapperEmo.querySelector('#textForReadability_aic').value;
                if (!text) { alert("Please enter text."); return; }
                const prompt = `Analyze the following text and provide an estimated Flesch-Kincaid Grade Level. Also, give a brief (1-2 sentence) qualitative assessment of its readability (e.g., "Easy to read for a general audience", "Requires a high level of technical understanding"). Text:\n\n"${text}"`;
                await callLlama3FreeEmo(prompt, 'readabilitySpinner_aic', 'readabilityOutput_aic');
            }
        },
        {
            id: 'textSentimentChecker', title: 'Text Sentiment Checker', icon: 'far fa-grin-stars', // Font Awesome regular
            description: 'Checks sentiment of text snippets using Deepgram Read.', llmMix: "Deepgram Read",
            html: () => `
                <h3 class="tool-title-emo">Sentiment Checker for Text Snippets</h3>
                <label for="textForSentiment_aic">Paste text snippet for sentiment analysis:</label>
                <input type="text" id="textForSentiment_aic" placeholder="e.g., I love this product!">
                <button onclick="aicTool_checkTextSentiment()" class="primary-button-emo">Check Sentiment</button>
                <div class="spinner-emo" id="textSentimentSpinner_aic"></div>
                <div class="output-emo" id="textSentimentOutput_aic"></div>`,
            action: async function aicTool_checkTextSentiment() {
                const text = currentAiToolWrapperEmo.querySelector('#textForSentiment_aic').value;
                if (!text) { alert("Please enter text for sentiment analysis."); return; }
                await callDeepgramReadEmo(text, { sentiment: true }, 'textSentimentSpinner_aic', 'textSentimentOutput_aic');
            }
        },
        {
            id: 'tweetFromBlog', title: 'Tweet Snippet Creator', icon: 'fab fa-twitter', // Font Awesome brands
            description: 'Creates tweet-sized snippets from blog paragraphs.', llmMix: "Llama-3",
            html: () => `
                <h3 class="tool-title-emo">"Tweet from Blog Post" Snippet Creator</h3>
                <label for="blogParagraphForTweet_aic">Paste a paragraph from your blog post:</label>
                <textarea id="blogParagraphForTweet_aic" rows="5" placeholder="One key takeaway is that..."></textarea>
                <button onclick="aicTool_generateTweetsFromParagraph()" class="primary-button-emo">Generate Tweets</button>
                <div class="spinner-emo" id="tweetFromBlogSpinner_aic"></div>
                <div class="output-emo" id="tweetFromBlogOutput_aic"></div>`,
            action: async function aicTool_generateTweetsFromParagraph() {
                const paragraph = currentAiToolWrapperEmo.querySelector('#blogParagraphForTweet_aic').value;
                if (!paragraph) { alert("Please paste a paragraph."); return; }
                const prompt = `Take the following paragraph and generate 2-3 tweet options (under 280 characters each) that summarize its key point or offer an engaging hook related to it. Include 1-2 relevant hashtags for each tweet.\n\nParagraph: "${paragraph}"`;
                await callLlama3FreeEmo(prompt, 'tweetFromBlogSpinner_aic', 'tweetFromBlogOutput_aic');
            }
        },
        {
            id: 'quoteFinder', title: 'Quote Finder from Text', icon: 'fas fa-quote-left',
            description: 'Extracts impactful or quotable sentences from text.', llmMix: "Llama-3",
             html: () => `
                <h3 class="tool-title-emo">Quote Finder from Text</h3>
                <label for="textForQuotes_aic">Paste text to find quotable sentences:</label>
                <textarea id="textForQuotes_aic" rows="7" placeholder="Enter a larger block of text here..."></textarea>
                <button onclick="aicTool_findQuotes()" class="primary-button-emo">Find Quotes</button>
                <div class="spinner-emo" id="quoteFinderSpinner_aic"></div>
                <div class="output-emo" id="quoteFinderOutput_aic"></div>`,
            action: async function aicTool_findQuotes() {
                const text = currentAiToolWrapperEmo.querySelector('#textForQuotes_aic').value;
                if (!text) { alert("Please paste text to find quotes from."); return; }
                const prompt = `From the following text, extract 3-5 impactful or highly quotable sentences. Present them as a list.\n\nText:\n${text}`;
                await callLlama3FreeEmo(prompt, 'quoteFinderSpinner_aic', 'quoteFinderOutput_aic');
            }
        },
        {
            id: 'faqGenerator', title: 'FAQ Generator', icon: 'fas fa-question-circle',
            description: 'Generates FAQs and answers from provided content.', llmMix: "Llama-3",
            html: () => `
                <h3 class="tool-title-emo">FAQ Generator from Content</h3>
                <label for="contentForFaqs_aic">Paste content to generate FAQs from:</label>
                <textarea id="contentForFaqs_aic" rows="7" placeholder="Enter your article or product description..."></textarea>
                <button onclick="aicTool_generateFaqs()" class="primary-button-emo">Generate FAQs</button>
                <div class="spinner-emo" id="faqGeneratorSpinner_aic"></div>
                <div class="output-emo" id="faqGeneratorOutput_aic"></div>`,
            action: async function aicTool_generateFaqs() {
                const content = currentAiToolWrapperEmo.querySelector('#contentForFaqs_aic').value;
                if (!content) { alert("Please paste content."); return; }
                const prompt = `Based on the following content, generate a list of 3-5 frequently asked questions (FAQs) along with their concise answers derived from the text. Format as: Q: [Question]\nA: [Answer]\n\nContent:\n${content}`;
                await callLlama3FreeEmo(prompt, 'faqGeneratorSpinner_aic', 'faqGeneratorOutput_aic');
            }
        },
        {
            id: 'colorPaletteGenerator', title: 'Image Color Palette', icon: 'fas fa-palette',
            description: 'Extracts a color palette from an uploaded image.', llmMix: "Llama-Vision + Llama-3",
            html: () => `
                <h3 class="tool-title-emo">Image to Color Palette Generator</h3>
                <label for="imageForPalette_aic">Upload image to extract color palette:</label>
                <input type="file" id="imageForPalette_aic" accept="image/*" onchange="imagePreview('imageForPalette_aic', 'colorPalettePreview_aic')">
                <img id="colorPalettePreview_aic" src="#" alt="Image preview" class="preview-emo" style="display:none; max-width: 200px;"/>
                <button onclick="aicTool_generateColorPalette()" class="primary-button-emo">Extract Palette</button>
                <div class="spinner-emo" id="colorPaletteSpinner_aic"></div>
                <div class="output-emo" id="colorPaletteOutput_aic">
                    <div id="paletteSwatches_aic" style="display:flex; flex-wrap:wrap; gap:10px; margin-top:10px;"></div>
                </div>`,
            action: async function aicTool_generateColorPalette() {
                const fileInput = currentAiToolWrapperEmo.querySelector('#imageForPalette_aic');
                if (!fileInput.files.length) { alert("Please upload an image."); return; }
                const imageFile = fileInput.files[0];
                const imageBase64 = await fileToBase64(imageFile);
                
                const outputElement = currentAiToolWrapperEmo.querySelector('#colorPaletteOutput_aic');
                const previewImgHTML = currentAiToolWrapperEmo.querySelector('#colorPalettePreview_aic').outerHTML;
                const paletteSwatchesDivId = 'paletteSwatches_aic';
                
                showSpinnerEmo('colorPaletteSpinner_aic');
                if (outputElement) outputElement.innerHTML = previewImgHTML + `<div id="${paletteSwatchesDivId}" style="display:flex; flex-wrap:wrap; gap:10px; margin-top:10px;"></div>`; 

                try {
                    const visionPrompt = "Identify up to 5 dominant colors in this image. List their hex codes if possible, or describe them clearly (e.g., 'deep blue', 'bright yellow').";
                    const colorDescription = await callLlamaVisionFreeEmo(imageBase64, visionPrompt, 'colorPaletteSpinner_aic', 'colorPaletteOutput_aic', '', 150);

                    if (colorDescription && typeof colorDescription === 'string') {
                        const parsePrompt = `From the following description of image colors, extract actual hex color codes (e.g., #FF0000) or common CSS color names (e.g., red, skyblue). List up to 5. If no hex codes are present, try to infer them from descriptions. Description: "${colorDescription}"`;
                        const extractedColorsText = await callLlama3FreeEmo(parsePrompt, 'colorPaletteSpinner_aic', 'colorPaletteOutput_aic', 100);
                        
                        const colors = extractedColorsText ? extractedColorsText.match(/#([0-9A-Fa-f]{6}|[0-9A-Fa-f]{3})|\b(AliceBlue|AntiqueWhite|Aqua|Aquamarine|Azure|Beige|Bisque|Black|BlanchedAlmond|Blue|BlueViolet|Brown|BurlyWood|CadetBlue|Chartreuse|Chocolate|Coral|CornflowerBlue|Cornsilk|Crimson|Cyan|DarkBlue|DarkCyan|DarkGoldenRod|DarkGray|DarkGrey|DarkGreen|DarkKhaki|DarkMagenta|DarkOliveGreen|DarkOrange|DarkOrchid|DarkRed|DarkSalmon|DarkSeaGreen|DarkSlateBlue|DarkSlateGray|DarkSlateGrey|DarkTurquoise|DarkViolet|DeepPink|DeepSkyBlue|DimGray|DimGrey|DodgerBlue|FireBrick|FloralWhite|ForestGreen|Fuchsia|Gainsboro|GhostWhite|Gold|GoldenRod|Gray|Grey|Green|GreenYellow|HoneyDew|HotPink|IndianRed|Indigo|Ivory|Khaki|Lavender|LavenderBlush|LawnGreen|LemonChiffon|LightBlue|LightCoral|LightCyan|LightGoldenRodYellow|LightGray|LightGrey|LightGreen|LightPink|LightSalmon|LightSeaGreen|LightSkyBlue|LightSlateGray|LightSlateGrey|LightSteelBlue|LightYellow|Lime|LimeGreen|Linen|Magenta|Maroon|MediumAquaMarine|MediumBlue|MediumOrchid|MediumPurple|MediumSeaGreen|MediumSlateBlue|MediumSpringGreen|MediumTurquoise|MediumVioletRed|MidnightBlue|MintCream|MistyRose|Moccasin|NavajoWhite|Navy|OldLace|Olive|OliveDrab|Orange|OrangeRed|Orchid|PaleGoldenRod|PaleGreen|PaleTurquoise|PaleVioletRed|PapayaWhip|PeachPuff|Peru|Pink|Plum|PowderBlue|Purple|RebeccaPurple|Red|RosyBrown|RoyalBlue|SaddleBrown|Salmon|SandyBrown|SeaGreen|SeaShell|Sienna|Silver|SkyBlue|SlateBlue|SlateGray|SlateGrey|Snow|SpringGreen|SteelBlue|Tan|Teal|Thistle|Tomato|Turquoise|Violet|Wheat|White|WhiteSmoke|Yellow|YellowGreen)\b/gi) : null;

                        const freshSwatchesContainer = currentAiToolWrapperEmo.querySelector(`#${paletteSwatchesDivId}`); // Re-query after innerHTML reset
                        if (colors && colors.length > 0 && freshSwatchesContainer) {
                            freshSwatchesContainer.innerHTML = ''; // Clear previous swatches/text if any
                            colors.slice(0, 5).forEach(color => {
                                const swatch = document.createElement('div');
                                swatch.style.width = '50px'; swatch.style.height = '50px'; swatch.style.backgroundColor = color;
                                swatch.style.border = '1px solid var(--emo-border)'; swatch.title = color;
                                freshSwatchesContainer.appendChild(swatch);
                            });
                            const textNode = document.createElement('div'); textNode.textContent = "Identified Colors: " + colors.join(', '); textNode.style.marginTop = '10px';
                            freshSwatchesContainer.appendChild(textNode);
                        } else if (freshSwatchesContainer) {
                            freshSwatchesContainer.innerHTML = '';
                            const textNode = document.createElement('div'); textNode.textContent = "Could not extract distinct color codes. AI Description: " + colorDescription;
                            freshSwatchesContainer.appendChild(textNode);
                        }
                    } else if (outputElement) {
                        displayErrorEmo('colorPaletteOutput_aic', Error("Could not get color description from Vision API."));
                    }
                } catch (error) { console.error("Color palette generation failed:", error); displayErrorEmo('colorPaletteOutput_aic', error); } 
                finally { hideSpinnerEmo('colorPaletteSpinner_aic'); }
            }
        },
        {
            id: 'eli5Simplifier', title: 'ELI5 Text Simplifier', icon: 'fas fa-child',
            description: 'Explains complex text in simple terms (Explain Like I\'m 5).', llmMix: "Llama-3",
            html: () => `
                <h3 class="tool-title-emo">"Explain Like I'm 5" Text Simplifier</h3>
                <label for="textToSimplify_aic">Paste complex text to simplify:</label>
                <textarea id="textToSimplify_aic" rows="5" placeholder="Quantum entanglement is a physical phenomenon..."></textarea>
                <button onclick="aicTool_simplifyEli5()" class="primary-button-emo">Simplify (ELI5)</button>
                <div class="spinner-emo" id="eli5Spinner_aic"></div>
                <div class="output-emo" id="eli5Output_aic"></div>`,
            action: async function aicTool_simplifyEli5() {
                const text = currentAiToolWrapperEmo.querySelector('#textToSimplify_aic').value;
                if (!text) { alert("Please enter text to simplify."); return; }
                const prompt = `Explain the following text as if you were talking to a 5-year-old. Use simple words and analogies.\n\nText: "${text}"`;
                await callLlama3FreeEmo(prompt, 'eli5Spinner_aic', 'eli5Output_aic');
            }
        },
        {
            id: 'featureToBenefit', title: 'Feature to Benefit Converter', icon: 'fas fa-exchange-alt',
            description: 'Converts product features into customer-focused benefits.', llmMix: "Llama-3",
            html: () => `
                <h3 class="tool-title-emo">Product Feature to Benefit Converter</h3>
                <label for="productFeatures_aic">List product features (one per line):</label>
                <textarea id="productFeatures_aic" rows="5" placeholder="e.g., Durable material\nLong battery life\nLightweight design"></textarea>
                <button onclick="aicTool_convertToBenefits()" class="primary-button-emo">Convert to Benefits</button>
                <div class="spinner-emo" id="featureToBenefitSpinner_aic"></div>
                <div class="output-emo" id="featureToBenefitOutput_aic"></div>`,
            action: async function aicTool_convertToBenefits() {
                const features = currentAiToolWrapperEmo.querySelector('#productFeatures_aic').value;
                if (!features) { alert("Please list product features."); return; }
                const prompt = `For each product feature listed below, describe the primary benefit it provides to the customer. Focus on "what's in it for them".\n\nFeatures:\n${features}\n\nFormat as:\nFeature: [Feature]\nBenefit: [Benefit]`;
                await callLlama3FreeEmo(prompt, 'featureToBenefitSpinner_aic', 'featureToBenefitOutput_aic');
            }
        },
        {
            id: 'ctaGenerator', title: 'Call-to-Action Generator', icon: 'fas fa-mouse-pointer',
            description: 'Generates compelling Call-to-Action (CTA) phrases.', llmMix: "Llama-3",
            html: () => `
                <h3 class="tool-title-emo">Call-to-Action (CTA) Generator</h3>
                <label for="ctaContext_aic">Describe content/goal for CTA:</label>
                <input type="text" id="ctaContext_aic" placeholder="e.g., Sign up for newsletter about AI tools">
                <button onclick="aicTool_generateCtas()" class="primary-button-emo">Generate CTAs</button>
                <div class="spinner-emo" id="ctaGeneratorSpinner_aic"></div>
                <div class="output-emo" id="ctaGeneratorOutput_aic"></div>`,
            action: async function aicTool_generateCtas() {
                const context = currentAiToolWrapperEmo.querySelector('#ctaContext_aic').value;
                if (!context) { alert("Please describe the content/goal for the CTA."); return; }
                const prompt = `Generate 3-5 compelling Call-to-Action (CTA) phrases related to: "${context}". Make them short, action-oriented, and persuasive.`;
                await callLlama3FreeEmo(prompt, 'ctaGeneratorSpinner_aic', 'ctaGeneratorOutput_aic');
            }
        },
        {
            id: 'hashtagGenerator', title: 'Hashtag Generator', icon: 'fas fa-hashtag',
            description: 'Generates relevant hashtags from text or image input.', llmMix: "Llama-Vision + Llama-3",
            html: () => `
                <h3 class="tool-title-emo">Hashtag Generator</h3>
                <label for="hashtagInputText_aic">Enter text for hashtags (optional):</label>
                <input type="text" id="hashtagInputText_aic" placeholder="e.g., My latest travel adventure in Paris">
                <label for="hashtagInputImage_aic">Upload image for hashtags (optional):</label>
                <input type="file" id="hashtagInputImage_aic" accept="image/*" onchange="imagePreview('hashtagInputImage_aic', 'hashtagImagePreview_aic')">
                <img id="hashtagImagePreview_aic" src="#" alt="Image preview" class="preview-emo" style="display:none; max-width: 200px;"/>
                <button onclick="aicTool_generateHashtags()" class="primary-button-emo">Generate Hashtags</button>
                <div class="spinner-emo" id="hashtagSpinner_aic"></div>
                <div class="output-emo" id="hashtagOutput_aic"></div>`,
            action: async function aicTool_generateHashtags() {
                const textInput = currentAiToolWrapperEmo.querySelector('#hashtagInputText_aic').value;
                const imageFileInput = currentAiToolWrapperEmo.querySelector('#hashtagInputImage_aic');
                if (!textInput && !imageFileInput.files.length) { alert("Please provide text or an image."); return; }
                
                const outputElement = currentAiToolWrapperEmo.querySelector('#hashtagOutput_aic');
                const previewImgHTML = imageFileInput.files.length ? currentAiToolWrapperEmo.querySelector('#hashtagImagePreview_aic').outerHTML : '';
                showSpinnerEmo('hashtagSpinner_aic');
                if(outputElement) outputElement.innerHTML = previewImgHTML;

                let contextForHashtags = textInput || "";
                try {
                    if (imageFileInput.files.length > 0) {
                        const imageBase64 = await fileToBase64(imageFileInput.files[0]);
                        const imageDescription = await callLlamaVisionFreeEmo(imageBase64, "Describe the key elements and theme of this image for hashtag generation.", 'hashtagSpinner_aic', 'hashtagOutput_aic','', 100);
                        if (imageDescription) contextForHashtags += (contextForHashtags ? " " : "") + imageDescription;
                    }
                    if (!contextForHashtags) { displayErrorEmo('hashtagOutput_aic', Error("Could not get context for hashtags.")); hideSpinnerEmo('hashtagSpinner_aic'); return; }

                    const hashtagPrompt = `Based on the following context, generate a list of 10-15 relevant and effective hashtags (mix of popular and niche if appropriate): "${contextForHashtags}"`;
                    const hashtags = await callLlama3FreeEmo(hashtagPrompt, 'hashtagSpinner_aic', 'hashtagOutput_aic', 150);
                    
                    if(hashtags && outputElement) { 
                        const textNode = document.createElement('div'); 
                        textNode.style.marginTop = '10px';
                        textNode.textContent = hashtags; 
                        if (outputElement.querySelector('img')) outputElement.appendChild(textNode);
                        else outputElement.innerHTML = previewImgHTML + textNode.outerHTML;
                    } else if (outputElement) {
                         displayOutputEmo('hashtagOutput_aic', hashtags || "No hashtags generated.");
                    }

                } catch (error) { console.error("Hashtag generation failed:", error); displayErrorEmo('hashtagOutput_aic', error); } 
                finally { hideSpinnerEmo('hashtagSpinner_aic'); }
            }
        },
        {
            id: 'intentSpotter', title: 'Intent Spotter', icon: 'fas fa-search-location',
            description: 'Identifies user intent from short text using Deepgram Read.', llmMix: "Deepgram Read",
            html: () => `
                <h3 class="tool-title-emo">Intent Spotter from Short Text</h3>
                <label for="textForIntent_aic">Enter short text to spot intent:</label>
                <input type="text" id="textForIntent_aic" placeholder="e.g., How do I reset my password?">
                <button onclick="aicTool_spotIntent()" class="primary-button-emo">Spot Intent</button>
                <div class="spinner-emo" id="intentSpotterSpinner_aic"></div>
                <div class="output-emo" id="intentSpotterOutput_aic"></div>`,
            action: async function aicTool_spotIntent() {
                const text = currentAiToolWrapperEmo.querySelector('#textForIntent_aic').value;
                if (!text) { alert("Please enter text to spot intent."); return; }
                await callDeepgramReadEmo(text, { intents: true }, 'intentSpotterSpinner_aic', 'intentSpotterOutput_aic');
            }
        },
        {
            id: 'pollQuestionGenerator', title: 'Poll/Quiz Question Generator', icon: 'fas fa-poll',
            description: 'Generates poll or quiz questions with options from a topic.', llmMix: "Llama-3",
            html: () => `
                <h3 class="tool-title-emo">Quick Poll/Quiz Question Generator</h3>
                <label for="pollTopic_aic">Topic for poll/quiz question:</label>
                <input type="text" id="pollTopic_aic" placeholder="e.g., Favorite programming language">
                <label for="pollType_aic">Type:</label>
                <select id="pollType_aic">
                    <option value="poll">Poll Question</option> <option value="quiz">Quiz Question (with answer)</option>
                </select>
                <button onclick="aicTool_generatePollQuestion()" class="primary-button-emo">Generate Question</button>
                <div class="spinner-emo" id="pollQuestionSpinner_aic"></div>
                <div class="output-emo" id="pollQuestionOutput_aic"></div>`,
            action: async function aicTool_generatePollQuestion() {
                const topic = currentAiToolWrapperEmo.querySelector('#pollTopic_aic').value;
                const type = currentAiToolWrapperEmo.querySelector('#pollType_aic').value;
                if (!topic) { alert("Please enter a topic."); return; }
                let prompt = "";
                if (type === "poll") {
                    prompt = `Generate a single, engaging poll question about "${topic}" with 3-4 plausible answer options. Format as:\nQuestion: [Question]\nOptions:\n- [Option 1]\n- [Option 2]\n- [Option 3]`;
                } else { 
                    prompt = `Generate a single, interesting quiz question about "${topic}" with 3-4 plausible answer options, and clearly indicate the correct answer. Format as:\nQuestion: [Question]\nOptions:\n- [Option A]\n- [Option B]\n- [Option C]\nCorrect Answer: [Letter of correct option] - [Correct Option Text]`;
                }
                await callLlama3FreeEmo(prompt, 'pollQuestionSpinner_aic', 'pollQuestionOutput_aic');
            }
        }
    ];


    aiToolsDefinitionsAic.forEach(toolDef => {
        if (toolDef.action && typeof toolDef.action === 'function') {
            window[toolDef.action.name] = toolDef.action; 
        }
    });

    function displayAiToolDashboard() {
        if (mainContentHeaderAic.querySelector('h2')) mainContentHeaderAic.querySelector('h2').textContent = "App Toolkit";
        if (mainContentHeaderAic.querySelector('p')) mainContentHeaderAic.querySelector('p').innerHTML = "Powered by Emilio LLM";
        if (pageTitleHeaderAic) {
            pageTitleHeaderAic.textContent = "AI Tools"; // Default title for dashboard
            pageTitleHeaderAic.classList.remove('hidden-title');
        }

        if(aiToolContentContainerEmo) aiToolContentContainerEmo.style.display = 'none';
        if(apiKeyNoticeEmo) apiKeyNoticeEmo.style.display = 'none'; // Keep it hidden if not explicitly populated
        if(dashboardContentAic) {
            dashboardContentAic.style.display = 'grid';
            dashboardContentAic.innerHTML = ''; 
            aiToolsDefinitionsAic.forEach(tool => { 
                dashboardContentAic.appendChild(renderAiToolCardEmo(tool));
            });
        }
    }

    function renderAiToolCardEmo(tool) {
        const card = document.createElement('div');
        card.classList.add('ai-tool-card-emo'); 
        card.dataset.toolId = tool.id; 
        let llmInfoHtml = tool.llmMix ? `<div class="llm-mix-info" title="${tool.llmMix}">Engine: ${tool.llmMix.split('+')[0].trim()}...</div>` : '';
        card.innerHTML = `
            <div class="icon-background-emo"><i class="${tool.icon || 'fas fa-tools'}"></i></div>
            <h3>${tool.title}</h3>
            <p class="tool-description-emo">${tool.description || 'Leverage AI for your tasks.'}</p>
            ${llmInfoHtml}
            <button class="btn-launch-emo">Use Tool</button>`; 
        card.addEventListener('click', () => activateAiToolEmo(tool.id));
        return card;
    }

    function activateAiToolEmo(toolId) {
        const toolDefinition = aiToolsDefinitionsAic.find(t => t.id === toolId);
        if (!toolDefinition) { displayAiToolDashboard(); return; }

        if (mainContentHeaderAic.querySelector('h2')) mainContentHeaderAic.querySelector('h2').textContent = toolDefinition.title;
        if (mainContentHeaderAic.querySelector('p')) mainContentHeaderAic.querySelector('p').innerHTML = toolDefinition.description || `Utilize the ${toolDefinition.title}.`;
        if (pageTitleHeaderAic) { 
             pageTitleHeaderAic.classList.add('hidden-title');
        }
        
        if(dashboardContentAic) dashboardContentAic.style.display = 'none';
        if(aiToolContentContainerEmo) aiToolContentContainerEmo.style.display = 'block';
        
        // Check if API keys are placeholders for the notice
        const placeholderApiKeys = ["YOUR_TOGETHER_API_KEY_PLACEHOLDER", "YOUR_DEEPGRAM_API_KEY"]; // Add other relevant placeholders
        let showApiNotice = false;
        if (TOGETHER_API_KEY === "YOUR_TOGETHER_API_KEY_PLACEHOLDER" || DEEPGRAM_API_KEY === "YOUR_DEEPGRAM_API_KEY") {
            showApiNotice = true;
        }
        // The apiKeyNoticeEmo div is empty, so showing it will just show an empty styled block.
        if(apiKeyNoticeEmo && showApiNotice) apiKeyNoticeEmo.style.display = 'block'; 
        else if (apiKeyNoticeEmo) apiKeyNoticeEmo.style.display = 'none';


        if(currentAiToolWrapperEmo && typeof toolDefinition.html === 'function') {
            currentAiToolWrapperEmo.innerHTML = toolDefinition.html();
        }
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    document.addEventListener('DOMContentLoaded', () => {
        if(pageLoadingElementAic) pageLoadingElementAic.querySelector('.loading-text').textContent = "ai-Connect";
        displayAiToolDashboard();
        if (pageLoadingElementAic) {
             setTimeout(() => { if(pageLoadingElementAic && !pageLoadingElementAic.classList.contains('hidden')) pageLoadingElementAic.classList.add('hidden'); }, 700);
        }
    });
    window.addEventListener('load', () => { 
        setTimeout(() => { if (pageLoadingElementAic && !pageLoadingElementAic.classList.contains('hidden')) pageLoadingElementAic.classList.add('hidden'); }, 3000);
    });

  </script>
</body>
</html>