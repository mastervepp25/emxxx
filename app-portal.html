<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>aiConnect - User Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="icon" href="assets/images/favicon.png" type="image/png">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <style>
    /* --- CSS Variables (from original template) --- */
    :root {
      /* Light Mode (Default - from new theme snippet) */
      --primary-color-light: #1F3A5C; /* Dark Blue */
      --primary-variant-color-light: #2c5282; /* Slightly Lighter Dark Blue */
      --accent-color-light: #4A90E2; /* Blue Accent */
      --background-color-light: #f0f2f5; /* Light Grey Background */
      --surface-color-light: #ffffff; /* White Card Background */
      --on-primary-color-light: #ffffff;
      --text-color-light: #333; /* Dark Text */
      --text-muted-color-light: #555; /* Medium Text */
      --border-color-light: #e2e8f0; /* Lighter border for light theme */
      --gradient-primary-light: linear-gradient(135deg, var(--accent-color-light) 0%, var(--primary-color-light) 100%);
      --trending-bg-light: #FFFBEB;
      --trending-text-light: #926319;
      --card-shadow-light: 0 1px 3px rgba(0, 0, 0, 0.08);
      
      /* Wallet Card Specific Light Theme (from new theme snippet) */
      --wallet-card-bg-light: linear-gradient(160deg, #2c3e50 0%, #1d2b3a 100%);
      --wallet-card-text-primary-light: #FFFFFF;
      --wallet-card-text-secondary-light: #BDC3C7;
      --wallet-card-chip-bg-light: linear-gradient(to bottom right, #d1b075, #a88854, #d1b075);
      --wallet-action-button-bg-light: rgba(255, 255, 255, 0.1);
      --wallet-action-button-border-light: rgba(255, 255, 255, 0.15);
      --wallet-action-button-hover-bg-light: rgba(255, 255, 255, 0.18);
      --wallet-action-button-hover-border-light: rgba(255, 255, 255, 0.3);

      /* Dark Mode (Galaxy.ai Inspired Colors, Inter Font) */
      --primary-color-dark: #00ffff; /* Cyan */
      --primary-variant-color-dark: #00cccc; /* Darker Cyan */
      --accent-color-dark: #ff5252; /* Reddish for Trending */
      --background-color-dark: #0d1117; /* Very Dark Blue/Almost Black */
      --surface-color-dark: #171b26; /* Dark Blue/Grey for cards, sidebar */
      --on-primary-color-dark: #0d1117; /* Text on cyan buttons (dark) */
      --text-color-dark: #c9d1d9; /* Light Grey/Off-white */
      --text-muted-color-dark: #8b949e; /* Muted Grey */
      --border-color-dark: rgba(0, 255, 255, 0.15); /* Cyan translucent border */
      --gradient-primary-dark: linear-gradient(135deg, var(--primary-variant-color-dark) 0%, var(--primary-color-dark) 100%);
      --sidebar-active-bg-dark: var(--primary-color-dark);
      --sidebar-text-on-active-dark: var(--on-primary-color-dark);
      --trending-bg-dark: var(--accent-color-dark);
      --trending-text-dark: #ffffff;
      --card-shadow-dark: 0 0 15px rgba(0, 255, 255, 0.07);

      /* Wallet Card Specific Dark Theme (Adapting its style to overall dark theme) */
      --wallet-card-bg-dark: var(--surface-color-dark); /* Use general surface color */
      --wallet-card-text-primary-dark: var(--text-color-dark);
      --wallet-card-text-secondary-dark: var(--text-muted-color-dark);
      --wallet-card-chip-bg-dark: linear-gradient(to bottom right, #4a5568, #2d3748, #4a5568); /* Darker chip */
      --wallet-action-button-bg-dark: rgba(0, 255, 255, 0.1);
      --wallet-action-button-border-dark: rgba(0, 255, 255, 0.2);
      --wallet-action-button-hover-bg-dark: rgba(0, 255, 255, 0.18);
      --wallet-action-button-hover-border-dark: rgba(0, 255, 255, 0.35);

      /* Shared Variables */
      --font-family: 'Inter', sans-serif;
      --font-display: 'Inter', sans-serif; 
      --font-body: 'Inter', sans-serif;
      --transition-speed: 0.25s;
      --sidebar-width: 240px; /* Increased slightly for new section */
      --sidebar-width-collapsed: 60px; 
      --topbar-height: 56px;
      --card-border-radius: 6px; 
      --card-padding: 0.9rem; 

      /* Base Font Sizes (Smaller) */
      --font-size-base: 0.78rem;       
      --font-size-small: 0.65rem;     
      --font-size-medium: 0.72rem;    
      --font-size-large: 0.85rem;     
      --font-size-xl: 1.1rem;       
      --font-size-card-description: 0.7rem; 
    }

    /* Initialize with Light Mode Variables */
    :root {
        --primary-color: var(--primary-color-light);
        --primary-variant-color: var(--primary-variant-color-light);
        --accent-color: var(--accent-color-light);
        --background-color: var(--background-color-light);
        --surface-color: var(--surface-color-light);
        --on-primary-color: var(--on-primary-color-light);
        --text-color: var(--text-color-light);
        --text-muted-color: var(--text-muted-color-light);
        --border-color: var(--border-color-light);
        --gradient-primary: var(--gradient-primary-light);
        --sidebar-active-bg: var(--primary-color-light);
        --sidebar-text-on-active: var(--on-primary-color-light);
        --trending-bg: var(--trending-bg-light);
        --trending-text: var(--trending-text-light);
        --card-shadow: var(--card-shadow-light);

        --wallet-card-bg: var(--wallet-card-bg-light);
        --wallet-card-text-primary: var(--wallet-card-text-primary-light);
        --wallet-card-text-secondary: var(--wallet-card-text-secondary-light);
        --wallet-card-chip-bg: var(--wallet-card-chip-bg-light);
        --wallet-action-button-bg: var(--wallet-action-button-bg-light);
        --wallet-action-button-border: var(--wallet-action-button-border-light);
        --wallet-action-button-hover-bg: var(--wallet-action-button-hover-bg-light);
        --wallet-action-button-hover-border: var(--wallet-action-button-hover-border-light);
    }

    [data-theme="dark"] {
        --primary-color: var(--primary-color-dark);
        --primary-variant-color: var(--primary-variant-color-dark);
        --accent-color: var(--accent-color-dark);
        --background-color: var(--background-color-dark);
        --surface-color: var(--surface-color-dark);
        --on-primary-color: var(--on-primary-color-dark);
        --text-color: var(--text-color-dark);
        --text-muted-color: var(--text-muted-color-dark);
        --border-color: var(--border-color-dark);
        --gradient-primary: var(--gradient-primary-dark);
        --sidebar-active-bg: var(--sidebar-active-bg-dark);
        --sidebar-text-on-active: var(--sidebar-text-on-active-dark);
        --trending-bg: var(--trending-bg-dark);
        --trending-text: var(--trending-text-dark);
        --card-shadow: var(--card-shadow-dark);

        --wallet-card-bg: var(--wallet-card-bg-dark);
        --wallet-card-text-primary: var(--wallet-card-text-primary-dark);
        --wallet-card-text-secondary: var(--wallet-card-text-secondary-dark);
        --wallet-card-chip-bg: var(--wallet-card-chip-bg-dark);
        --wallet-action-button-bg: var(--wallet-action-button-bg-dark);
        --wallet-action-button-border: var(--wallet-action-button-border-dark);
        --wallet-action-button-hover-bg: var(--wallet-action-button-hover-bg-dark);
        --wallet-action-button-hover-border: var(--wallet-action-button-hover-border-dark);
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
    body {
        font-family: var(--font-family); background-color: var(--background-color); color: var(--text-color);
        line-height: 1.5; font-size: var(--font-size-base);
        transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
        overflow-x: hidden;
    }
    a { text-decoration: none; color: var(--primary-color); transition: color var(--transition-speed) ease; }
    a:hover { text-decoration: underline; color: var(--primary-variant-color); }
    ul { list-style: none; }
    img { max-width: 100%; height: auto; display: block; }
    button { font-family: inherit; cursor: pointer; border: none; border-radius: 5px;
             transition: background-color var(--transition-speed), transform 0.1s, box-shadow var(--transition-speed); }
    button:active { transform: translateY(1px) scale(0.98); }
    .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24; vertical-align: middle; }


    .app-container { display: flex; min-height: 100vh; }

    /* Sidebar (WeConnect Structure, New Theme Applied) */
    .sidebar {
        width: var(--sidebar-width); background-color: var(--surface-color);
        border-right: 1px solid var(--border-color); position: fixed; top: 0; left: 0; height: 100%;
        padding: 0.7rem 0; overflow-y: auto; overflow-x: hidden;
        transition: width var(--transition-speed) ease, transform var(--transition-speed) ease,
                    background-color var(--transition-speed) ease, border-color var(--transition-speed) ease;
        z-index: 1000;
    }
    .sidebar::-webkit-scrollbar { width: 4px; }
    .sidebar::-webkit-scrollbar-thumb { background-color: var(--border-color); border-radius: 2px; }

    .sidebar-header {
        display: flex; align-items: center; padding: 0 0.8rem;
        border-bottom: 1px solid var(--border-color); margin-bottom: 0.7rem;
        min-height: var(--topbar-height);
    }
    .sidebar-header .logo { height: 26px; width: auto; margin-right: 0.5rem; object-fit: contain; }
    .sidebar-header .app-title-sidebar {
        font-family: var(--font-display); font-size: 1rem; font-weight: 600;
        color: var(--text-color); white-space: nowrap; opacity: 1;
        transition: opacity var(--transition-speed) ease 0.1s, color var(--transition-speed) ease;
    }
     [data-theme="dark"] .sidebar-header .app-title-sidebar { color: var(--primary-color); }


    .sidebar-nav ul { padding: 0 0.6rem; }
    .sidebar-nav .nav-heading {
        font-family: var(--font-display); font-size: var(--font-size-small); text-transform: uppercase; letter-spacing: 0.5px;
        color: var(--text-muted-color); padding: 0.7rem 0.3rem 0.3rem;
        font-weight: 500; white-space: nowrap; opacity: 1;
    }
    .sidebar-nav li a {
        display: flex; align-items: center; padding: 0.5rem 0.4rem;
        color: var(--text-color); border-radius: 4px; margin-bottom: 0.15rem;
        font-family: var(--font-body); font-size: var(--font-size-medium); font-weight: 500;
    }
    .sidebar-nav li a i.fas, .sidebar-nav li a i.far { font-size: 0.85rem; min-width: 16px; margin-right: 0.6rem; text-align: center; }
    .sidebar-nav li a:hover { background-color: rgba(0,0,0,0.04); color: var(--primary-color); }
    [data-theme="dark"] .sidebar-nav li a:hover { background-color: rgba(255,255,255,0.05); }
    .sidebar-nav li a.active { background: var(--sidebar-active-bg); color: var(--sidebar-text-on-active); }
    .sidebar-nav li a.active i.fas, .sidebar-nav li a.active i.far { color: var(--sidebar-text-on-active); }


    .sidebar.collapsed { width: var(--sidebar-width-collapsed); }
    .sidebar.collapsed .sidebar-header { padding-left: 0; padding-right: 0; justify-content: center;}
    .sidebar.collapsed .sidebar-header .app-title-sidebar { opacity: 0; pointer-events: none; width: 0; }
    .sidebar.collapsed .sidebar-header .logo { margin-right: 0; height: 24px; }
    .sidebar.collapsed .sidebar-nav .nav-heading { opacity: 0; pointer-events: none; height: 0; padding: 0; margin: 0; }
    .sidebar.collapsed .sidebar-nav li a span { opacity: 0; pointer-events: none; width: 0; }
    .sidebar.collapsed .sidebar-nav li a { justify-content: center; padding: 0.5rem 0; }
    .sidebar.collapsed .sidebar-nav li a i.fas, .sidebar.collapsed .sidebar-nav li a i.far { margin-right: 0; font-size: 0.95rem; }
            
    .main-wrapper { flex-grow: 1; margin-left: var(--sidebar-width); display: flex; flex-direction: column; transition: margin-left var(--transition-speed) ease; }
    .sidebar.collapsed + .main-wrapper { margin-left: var(--sidebar-width-collapsed); }

    /* Topbar (WeConnect Structure, New Theme Applied) */
    .topbar {
        height: var(--topbar-height); background-color: var(--surface-color);
        border-bottom: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between;
        padding: 0 1rem; position: sticky; top: 0; z-index: 900; box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    [data-theme="dark"] .topbar { box-shadow: 0 1px 2px rgba(0, 255, 255, 0.05); }


    .hamburger-btn {
        background: none; border: none; color: var(--text-color); font-size: 1.2rem; cursor: pointer;
        margin-right: 0.6rem; display: flex; align-items: center; justify-content: center;
        width: 32px; height: 32px; border-radius: 50%;
    }
    .hamburger-btn:hover { background-color: rgba(0,0,0,0.05); }
    [data-theme="dark"] .hamburger-btn { color: var(--primary-color); }
    [data-theme="dark"] .hamburger-btn:hover { background-color: rgba(0, 255, 255, 0.08); }
            
    .app-title-topbar { font-family: var(--font-display); font-size: var(--font-size-xl); font-weight: 600; color: var(--primary-color); }
    [data-theme="dark"] .app-title-topbar { color: var(--primary-color); }


    .topbar-right { display: flex; align-items: center; gap: 0.6rem; }
    .btn { padding: 0.4rem 0.8rem; border-radius: 5px; font-weight: 600; font-family: var(--font-display); font-size: 0.7rem; }
    .btn-upgrade { background: var(--primary-color); color: var(--on-primary-color); }
    .btn-upgrade:hover { opacity: 0.9; background-color: var(--primary-variant-color); }
    [data-theme="dark"] .btn-upgrade { background: var(--primary-color); color: var(--on-primary-color-dark); }
    [data-theme="dark"] .btn-upgrade:hover { background: var(--primary-variant-color); }

    .btn-upgrade i.fas { margin-right: 0.3rem; font-size: 0.9em; }

    .theme-toggle-btn {
        background: none; border: 1px solid var(--border-color); color: var(--text-muted-color);
        font-size: 0.9rem; width: 32px; height: 32px; border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
    }
    .theme-toggle-btn:hover { background-color: rgba(0,0,0,0.03); }
    [data-theme="dark"] .theme-toggle-btn { border-color: var(--primary-color); color: var(--primary-color); }
    [data-theme="dark"] .theme-toggle-btn:hover { background-color: rgba(0, 255, 255, 0.08); }

    .profile-menu .profile-icon { width: 32px; height: 32px; border-radius: 50%; cursor: pointer; border: 1px solid var(--border-color); }
    [data-theme="dark"] .profile-menu .profile-icon { border-color: var(--primary-color); }


    .content-area { flex-grow: 1; padding: 1rem; overflow-y: auto; }
    .content-header { margin-bottom: 1rem; }
    .content-header h2 { font-family: var(--font-display); font-size: var(--font-size-large); font-weight: 600; margin-bottom: 0.2rem; color: var(--text-color); }
    .content-header p { font-size: var(--font-size-base); color: var(--text-muted-color); font-family: var(--font-body); }

    /* Wallet Card (from new theme snippet, integrated) */
    .wallet-info-card {
      background: var(--wallet-card-bg);
      color: var(--wallet-card-text-primary);
      border-radius: var(--card-border-radius); 
      padding: var(--card-padding);
      box-shadow: var(--card-shadow); 
      position: relative;
      overflow: hidden;
      margin-bottom: 1rem; 
    }
    .wallet-info-card-header {
      display: flex; justify-content: space-between; align-items: flex-start;
      margin-bottom: var(--card-padding);
    }
    .wallet-info-card .user-info .user-name { 
        color: var(--wallet-card-text-primary); font-weight: 600; 
        font-size: 0.9rem; margin-bottom: 2px; 
    }
    .wallet-info-card .user-info .user-id { 
        color: var(--wallet-card-text-secondary); font-size: 0.65rem; opacity: 0.8; 
    }
    .wallet-info-card .card-chip { 
        width: 36px; height: 26px; background-image: var(--wallet-card-chip-bg); 
        border-radius: 4px; box-shadow: inset 0px 0.5px 1px rgba(0,0,0,0.3), 0px 0.5px 0.5px rgba(255,255,255,0.1); 
        margin-top: 2px;
    }
    .wallet-info-card .balance-details { 
      display: flex; justify-content: space-around; align-items: flex-start;
      margin-bottom: var(--card-padding); gap: 0.5rem;
    }
    .wallet-info-card .balance-source { flex: 1; padding: 0 0.25rem; text-align: center; }
    .wallet-info-card .balance-details .balance-amount { 
      color: var(--wallet-card-text-primary); font-size: 1.3rem; font-weight: 600;
      letter-spacing: -0.5px; margin-bottom: 2px;
    }
    .wallet-info-card .balance-details .balance-label { 
      color: var(--wallet-card-text-secondary); font-size: 0.6rem; text-transform: uppercase;
      letter-spacing: 0.5px; opacity: 0.9;
    }
    .wallet-info-card .wallet-actions { 
        display: flex; gap: 0.7rem;
    }
    .wallet-info-card .wallet-actions .action-button {
      background-color: var(--wallet-action-button-bg);
      color: var(--wallet-card-text-primary);
      border: 1px solid var(--wallet-action-button-border);
      font-weight: 500; padding: 0.4rem 0.8rem; border-radius: 5px;
      flex: 1; display: flex; align-items: center; justify-content: center;
      gap: 6px; font-size: 0.75rem;
    }
    .wallet-info-card .wallet-actions .action-button .material-symbols-outlined {
        font-size: 1rem; font-variation-settings: 'wght' 500;
    }
    .wallet-info-card .wallet-actions .action-button:hover { 
        background-color: var(--wallet-action-button-hover-bg); 
        border-color: var(--wallet-action-button-hover-border); 
    }


    /* Tool Grid (WeConnect structure, New Theme Applied) */
    .weconnect-tool-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 1rem; }
    .weconnect-tool-card { /* Renamed to avoid clash with AI tool card */
        background-color: var(--surface-color); border-radius: var(--card-border-radius);
        padding: var(--card-padding); box-shadow: var(--card-shadow);
        border: 1px solid var(--border-color); position: relative;
        transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease, border-color var(--transition-speed) ease;
    }
    [data-theme="dark"] .weconnect-tool-card { border: 1px solid var(--border-color-dark); }
    .weconnect-tool-card:hover { transform: translateY(-3px); box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
    [data-theme="dark"] .weconnect-tool-card:hover { border-color: var(--primary-color); box-shadow: 0 0 15px rgba(0, 255, 255, 0.12); }

    .weconnect-tool-card-header { display: flex; align-items: center; margin-bottom: 0.5rem; }
    .weconnect-tool-card-header i.fas { font-size: 0.85rem; color: var(--primary-color); margin-right: 0.5rem; }
    [data-theme="dark"] .weconnect-tool-card-header i.fas { color: var(--primary-color); }
    .weconnect-tool-card h3 { 
        font-family: var(--font-display); font-size: var(--font-size-medium); font-weight: 600;
        color: var(--text-color); margin: 0; 
    }
    .weconnect-tool-card p { 
        font-family: var(--font-body); font-size: var(--font-size-card-description); color: var(--text-muted-color);
        margin-bottom: 0.6rem; line-height: 1.45;
        min-height: 2.8em; 
    }
    .weconnect-tool-card .btn-launch { 
        display: inline-block; background-color: var(--primary-color); color: var(--on-primary-color);
        padding: 0.35rem 0.7rem; border-radius: 4px; text-align: center;
        font-family: var(--font-display); font-size: 0.7rem; font-weight: 600;
    }
    .weconnect-tool-card .btn-launch:hover { background-color: var(--primary-variant-color); }
    [data-theme="dark"] .weconnect-tool-card .btn-launch { background-color: var(--primary-color); color: var(--on-primary-color-dark); }
    [data-theme="dark"] .weconnect-tool-card .btn-launch:hover { background-color: var(--primary-variant-color); }


    .trending-tag {
        position: absolute; top: 0.5rem; right: 0.5rem; background-color: var(--trending-bg);
        color: var(--trending-text); padding: 0.15rem 0.35rem;
        font-weight: 600; font-family: var(--font-display); border-radius: 3px; text-transform: uppercase;
        font-size: 0.58rem; letter-spacing: 0.5px;
    }
    [data-theme="dark"] .trending-tag { box-shadow: 0 0 3px var(--accent-color-dark); }

    /* Loading Spinner (from new theme snippet) */
    #pageLoading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(240, 242, 245, 0.9); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1001; transition: opacity 0.3s ease, visibility 0s linear 0.3s; }
    [data-theme="dark"] #pageLoading { background-color: rgba(13, 17, 23, 0.95); }
    #pageLoading.hidden { opacity: 0; visibility: hidden; }
    #pageLoading .loading-text { font-size: 1rem; font-weight: 500; color: var(--text-color); }
    #pageLoading .spinner { border: 3px solid rgba(0,0,0,0.1); border-top: 3px solid var(--primary-color); border-radius: 50%; width: 28px; height: 28px; animation: spin 0.8s linear infinite; margin-bottom: 12px; }
    [data-theme="dark"] #pageLoading .spinner { border-color: rgba(0,255,255,0.1); border-top-color: var(--primary-color); }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }


    /* --- AI Creator Tool Specific Styles (using Tailwind classes primarily in JS, but some base styles here) --- */
    #aiToolContentContainer .ai-tool-wrapper-card { /* This will be the .tool-card from previous example */
        background-color: var(--surface-color); /* Use theme surface color */
        border: 1px solid var(--border-color);
        border-radius: var(--card-border-radius);
        padding: 1.5rem; /* p-6 */
        margin-bottom: 1.5rem; /* mb-6 */
        box-shadow: var(--card-shadow);
    }
    [data-theme="dark"] #aiToolContentContainer .ai-tool-wrapper-card {
        border-color: var(--border-color-dark);
    }

    #aiToolContentContainer .ai-tool-wrapper-card h3 { /* AI Tool title */
        font-size: 1.25rem; /* text-xl */
        font-weight: 600; /* font-semibold */
        margin-bottom: 1rem; /* mb-4 */
        color: var(--text-color); 
    }
    #aiToolContentContainer .ai-tool-wrapper-card label {
        display: block;
        margin-bottom: 0.5rem; /* mb-2 */
        font-weight: 500; /* font-medium */
        color: var(--text-muted-color);
    }
    /* Input, textarea, select will be styled by Tailwind classes directly in JS tool HTML generation */
    /* Button will be styled by Tailwind classes directly in JS tool HTML generation */
    
    #aiToolContentContainer .output { /* For text, images, audio from AI tools */
        margin-top: 1rem; /* mt-4 */
        padding: 1rem; /* p-4 */
        background-color: var(--background-color); /* Lighter shade of bg or specific color */
        border: 1px solid var(--border-color);
        border-radius: 0.375rem; /* rounded-md */
        white-space: pre-wrap;
        word-wrap: break-word;
        color: var(--text-color);
    }
    [data-theme="light"] #aiToolContentContainer .output {
         background-color: #eef2ff; /* indigo-50 */
         border: 1px solid #c7d2fe; /* indigo-200 */
    }
     [data-theme="dark"] #aiToolContentContainer .output {
         background-color: rgba(0, 255, 255, 0.03); 
         border: 1px solid rgba(0, 255, 255, 0.1);
    }

    #aiToolContentContainer .output img {
        max-width: 100%;
        height: auto;
        border-radius: 0.375rem; /* rounded-md */
        margin-top: 0.5rem; /* mt-2 */
        border: 1px solid var(--border-color);
    }
    #aiToolContentContainer .output audio {
        width: 100%;
        margin-top: 0.5rem; /* mt-2 */
    }
    /* Simple loading spinner for AI tools */
    #aiToolContentContainer .spinner {
        border: 4px solid rgba(0, 0, 0, .1);
        width: 36px;
        height: 36px;
        border-radius: 50%;
        border-left-color: var(--primary-color); 
        animation: spin 1s ease infinite;
        margin: 1rem auto;
        display: none; /* Hidden by default */
    }
    [data-theme="dark"] #aiToolContentContainer .spinner {
         border-color: rgba(255,255,255,0.1);
         border-left-color: var(--primary-color);
    }
    /* End AI Creator Tool Specific Styles */


    @media (max-width: 767px) {
        .sidebar { transform: translateX(-100%); }
        .sidebar.open { transform: translateX(0); box-shadow: 2px 0 12px rgba(0,0,0,0.08); }
        [data-theme="dark"] .sidebar.open { box-shadow: 2px 0 15px rgba(0, 255, 255, 0.08); }
        .main-wrapper { margin-left: 0 !important; }
        .app-title-topbar { display: none; }
        .content-area { padding: 0.8rem; }
        .weconnect-tool-grid { grid-template-columns: 1fr; gap: 0.8rem; }
        .btn-upgrade span { display: none; }
        .btn-upgrade i.fas { margin-right: 0; }
        .topbar { padding: 0 0.8rem; }
    }
  </style>
</head>
<body>
    <div id="pageLoading">
        <div class="spinner"></div>
        <p class="loading-text">Loading aiConnect...</p>
    </div><div class="app-container">
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNNTAsNCBDMjQuNSw0IDQsMjQuNSA0LDUwYzAsMjUuNSAyMC41LDQ2IDQ2LDQ2czQ2LTIwLjUgNDYtNDZDMzYuNSwyNC41IDc1LjUsNCA1MCw0ek0yNSwzNSBDMzAuNSwzNSAzNSwzMC41IDM1LDI1YzAtNS41LTQuNS0xMC0xMC0xMFMyNSwxOS41IDI1LDI1QzI1LDMwLjUgMjkuNSwzNSAzMCwzNXpNMTUsNzAgQzE1LDY0LjUgMTkuNSw2MCAyNSw2MGMyLjUsMCA1LDAuOCA3LDIuMkw0MCw1MGwtNy44LTEyQzI5LjcsMzggMjcuNSwzOCAyNSwzOHMtNSwyLjUtNSw1Vjcwek03NSw2NSBDNjkuNSw2NSA2NSw2OS41IDY1LDc1YzAsNS41IDQuNSwxMCAxMCwxMFM4NSw4MC41IDg1LDc1Qzg1LDY5LjUgODAuNSw2NSA3NSw2NXpNODUsMzAgQzg1LDM1LjUgODAuNSw0MCA3NSw0MGMtMi41LDAtNS0wLjgtNy0yLjJMNjAsNTBsNy44LDEyQzcwLjMsNjIgNzIuNSw2MiA3NSw2MnM1LTIuNSA1LTVWMzB6IiBmaWWwPSIjMWYzYTVjIi8+PC9zdmc+" alt="WeConnect Logo Placeholder" class="logo"> 
            <span class="app-title-sidebar">aiConnect</span>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li class="nav-heading">Main</li>
                <li><a href="#" class="main-nav-link active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a></li>
                <li><a href="#" class="main-nav-link" data-section="all-weconnect-tools"><i class="fas fa-th-large"></i><span>All Tools</span></a></li>
                <li><a href="#" class="main-nav-link" data-section="favorites"><i class="fas fa-star"></i><span>Favorites</span></a></li>

                <li class="nav-heading">Content Tools (Original)</li>
                <li><a href="#" class="main-nav-link" data-section="ai-text-editor"><i class="fas fa-edit"></i><span>AI Text Editor</span></a></li>
                <li><a href="#" class="main-nav-link" data-section="ai-blog-writer"><i class="fas fa-blog"></i><span>AI Blog Writer</span></a></li>
                <li><a href="#" class="main-nav-link" data-section="ai-script-generator"><i class="fas fa-scroll"></i><span>AI Script Generator</span></a></li>
                
                <li class="nav-heading" id="aiCreatorSuiteNavHeader">AI Creator Suite</li>
                <!-- AI Creator Suite links will be populated by JavaScript -->
                <div id="aiCreatorSuiteNavLinks"></div>

                <li class="nav-heading">User</li>
                <li><a href="#" class="main-nav-link" data-section="profile"><i class="fas fa-user-circle"></i><span>My Profile</span></a></li>
                <li><a href="#" class="main-nav-link" data-section="settings"><i class="fas fa-cog"></i><span>Settings</span></a></li>
                <li><a href="#" class="main-nav-link" data-section="support"><i class="fas fa-life-ring"></i><span>Support</span></a></li>
                <li><a href="#" id="signOutLink"><i class="fas fa-sign-out-alt"></i><span>Logout</span></a></li>
            </ul>
        </nav>
    </aside>

    <div class="main-wrapper">
        <header class="topbar">
            <div class="topbar-left">
                <button class="hamburger-btn" id="hamburgerBtn" aria-label="Toggle Menu">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="app-title-topbar">aiConnect</h1>
            </div>
            <div class="topbar-right">
                <button class="btn btn-upgrade"><i class="fas fa-rocket"></i> <span>Upgrade</span></button>
                <button class="theme-toggle-btn" id="themeToggleBtn" aria-label="Toggle Theme">
                    <i class="fas fa-moon"></i>
                </button>
                <div class="profile-menu">
                     <span class="material-symbols-outlined" style="cursor:pointer; font-size: 22px;" id="profileMenuIcon" title="Profile Options">account_circle</span>
                </div>
            </div>
        </header>

        <main class="content-area">
            <!-- Wallet Card integrated here -->
            <div class="wallet-info-card" id="walletCard">
              <div class="wallet-info-card-header">
                <div class="user-info">
                    <div class="user-name" id="userName">Welcome, Loading...</div>
                    <div class="user-id" id="memberId">ID: Loading...</div>
                </div>
                <div class="card-chip"></div>
              </div>
              <div class="balance-details">
                <div class="balance-source">
                  <div class="balance-amount" id="unilevelIncome">₱0.00</div>
                  <div class="balance-label">Wallet Balance</div>
                </div>
                <div class="balance-source">
                   <div class="balance-amount" id="tokenBalance">0.00</div>
                   <div class="balance-label">EMX Token</div>
                </div>
              </div>
              <div class="wallet-actions">
                <button id="historyButton" class="action-button">
                    <span class="material-symbols-outlined">history</span>
                    History
                </button>
                <button id="connectButton" class="action-button">
                    <span class="material-symbols-outlined">link</span>
                    Connect
                </button>
              </div>
            </div>

            <div class="content-header" id="mainContentHeader">
                <h2>Dashboard Tools</h2>
                <p>Explore our collection of AI-powered tools.</p>
            </div>
            <div class="weconnect-tool-grid" id="weconnectToolGrid">
                <!-- WeConnect Tool cards will be dynamically inserted here -->
            </div>

            <!-- Container for AI Creator Suite Tools -->
            <div id="aiToolContentContainer" style="display: none;">
                 <!-- Selected AI Tool's HTML will be injected here -->
                 <div class="ai-tool-wrapper-card" id="currentAiToolWrapper">
                    <!-- Content like inputs, buttons, output area for the active AI tool -->
                 </div>
            </div>
             <!-- API Key Configuration Notice (for AI Tools) -->
            <div id="apiKeyNotice" class="ai-tool-wrapper-card bg-yellow-50 border-yellow-300 my-4 p-4" style="display:none;">
                <h3 class="text-yellow-800 font-semibold">Important: API Key Configuration</h3>
                <p class="text-yellow-700 text-sm">
                    To use the AI Creator Suite tools, you must configure your API keys in the JavaScript section at the bottom of this HTML file.
                    Replace placeholders like <code>YOUR_TOGETHER_API_KEY</code> and <code>YOUR_DEEPGRAM_API_KEY</code> with your actual keys if they are not set.
                    <br><strong>Never deploy this file publicly with hardcoded API keys. For production, use a backend proxy.</strong>
                </p>
            </div>
        </main>
    </div>
</div>

<script>
// --- Firebase Config (from user's previous HTML) ---
const firebaseConfig = {
    apiKey: "AIzaSyDwldURmtljNpORmpGRacwXriPmQZjF6j8",
    authDomain: "daisy-n7g20a.firebaseapp.com",
    databaseURL: "https://daisy-n7g20a-default-rtdb.firebaseio.com",
    projectId: "daisy-n7g20a",
    storageBucket: "daisy-n7g20a.appspot.com",
    messagingSenderId: "225362605902",
    appId: "1:225362605902:web:d2551cc389e78c92c3d01f"
 };

    if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); } else { firebase.app(); }
    const auth = firebase.auth();
    const db = firebase.firestore();

    // --- API Key Configuration for AI Creator Suite (from user's previous HTML) ---
    const TOGETHER_API_KEY = "144f137285e61f4f20c3af158629a0aaee85f131c8a48cd5ffdd0e6477898407"; 
    const DEEPGRAM_API_KEY = "5431a4360985a2cd68978b3b2908c13bca576830"; 


    // --- Theme Toggle Logic (Original) ---
    const themeToggleBtn = document.getElementById('themeToggleBtn');
    const storedTheme = localStorage.getItem('theme');

    function applyTheme(theme) {
        if (theme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            if (themeToggleBtn) themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
            localStorage.setItem('theme', 'dark');
        } else { 
            document.documentElement.removeAttribute('data-theme');
            if (themeToggleBtn) themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
            localStorage.setItem('theme', 'light');
        }
    }
    function initTheme() {
        let initialTheme = 'light'; 
        if (storedTheme) initialTheme = storedTheme;
        applyTheme(initialTheme);
    }
    if (themeToggleBtn) {
        themeToggleBtn.addEventListener('click', () => {
            const currentTheme = document.documentElement.hasAttribute('data-theme') ? 'dark' : 'light';
            applyTheme(currentTheme === 'light' ? 'dark' : 'light');
        });
    }

    // --- Sidebar Logic (Original) ---
    const sidebar = document.getElementById('sidebar');
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const mainWrapper = document.querySelector('.main-wrapper');

    function getCssVariableValue(variableName) { return getComputedStyle(document.documentElement).getPropertyValue(variableName).trim(); }
    function toggleSidebar() {
        if (!sidebar || !mainWrapper) return;
        const isMobile = window.innerWidth <= 767;
        if (isMobile) sidebar.classList.toggle('open');
        else { 
            sidebar.classList.toggle('collapsed');
        }
    }
    function setInitialSidebarState() {
        if (!sidebar || !mainWrapper) return;
        const isMobile = window.innerWidth <= 767;
        if (isMobile) {
            sidebar.classList.remove('collapsed', 'open'); 
        } else { 
            sidebar.classList.remove('open');
        }
    }
    if (hamburgerBtn) hamburgerBtn.addEventListener('click', toggleSidebar);
    document.addEventListener('click', function(event) {
        if (window.innerWidth <= 767 && sidebar && sidebar.classList.contains('open') && !sidebar.contains(event.target) && hamburgerBtn && !hamburgerBtn.contains(event.target)) {
            sidebar.classList.remove('open');
        }
    });
    window.addEventListener('resize', setInitialSidebarState);

    // --- WeConnect Tools Data & Display (Original) ---
    const weConnectToolsData = [
        { id: 'weconnect-ai-text-editor', name: 'AI Text Editor (Platform)', description: 'Enhance writing with AI grammar checks & style suggestions.', icon: 'fas fa-edit', trending: true },
        { id: 'weconnect-ai-image-generator', name: 'AI Image Generator (Platform)', description: 'Create unique images from text prompts using AI models.', icon: 'fas fa-image', trending: true },
        { id: 'weconnect-ai-video-generator', name: 'AI Video Generator (Platform)', description: 'Produce videos from scripts with AI voiceovers & visuals.', icon: 'fas fa-video' },
        { id: 'weconnect-voice-cloner', name: 'Voice Cloner (Platform)', description: 'Clone voices for narrations and content creation.', icon: 'fas fa-microphone-alt' },
        { id: 'weconnect-chat-with-ai', name: 'Chat with AI (Platform)', description: 'Intelligent conversations, get answers, brainstorm ideas.', icon: 'fas fa-comments' },
        { id: 'weconnect-translator', name: 'Translator (Platform)', description: 'Translate text between languages with high accuracy.', icon: 'fas fa-globe-americas', trending: true }
    ];
    const weConnectToolGrid = document.getElementById('weconnectToolGrid');
    function renderWeConnectToolCard(tool) {
        const card = document.createElement('div');
        card.classList.add('weconnect-tool-card');
        let trendingTagHtml = tool.trending ? '<span class="trending-tag">Trending</span>' : '';
        card.innerHTML = `${trendingTagHtml}<div class="weconnect-tool-card-header"><i class="${tool.icon || 'fas fa-tools'}"></i><h3>${tool.name}</h3></div><p>${tool.description}</p><a href="#" class="btn btn-launch">Launch</a>`;
        return card;
    }
    function displayWeConnectTools(tools) {
        if (!weConnectToolGrid) return;
        weConnectToolGrid.innerHTML = ''; 
        tools.forEach(tool => weConnectToolGrid.appendChild(renderWeConnectToolCard(tool)));
    }
    async function fetchWeConnectToolsFromAPI() { 
        await new Promise(resolve => setTimeout(resolve, 50)); return weConnectToolsData; 
    }
    async function loadAndDisplayWeConnectTools() {
        const fetchedTools = await fetchWeConnectToolsFromAPI();
        if (weConnectToolGrid && fetchedTools && fetchedTools.length > 0) displayWeConnectTools(fetchedTools);
        else if(weConnectToolGrid) weConnectToolGrid.innerHTML = '<p>No WeConnect platform tools available.</p>';
    }

    // --- Firebase User Data & Wallet Card Logic (Original) ---
    const userNameElement = document.getElementById('userName');
    const memberIdElement = document.getElementById('memberId');
    const walletBalanceElement = document.getElementById('unilevelIncome'); 
    const tokenBalanceDisplayElement = document.getElementById('tokenBalance'); 
    const pageLoadingElement = document.getElementById('pageLoading');
    const historyButton = document.getElementById('historyButton');
    const connectButton = document.getElementById('connectButton');
    const signOutLinkSidebar = document.getElementById('signOutLink'); 
    const profileMenuIcon = document.getElementById('profileMenuIcon');


    function formatCurrency(amount, includeSymbol = true, currency = '₱') { 
        const numericAmount = Number(amount) || 0;
        const formatted = numericAmount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        return includeSymbol ? currency + formatted : formatted;
    }

    async function fetchAndDisplayUserData(user) {
        if (!user) {
            if(pageLoadingElement) pageLoadingElement.classList.add('hidden');
            return;
        }
        try {
            const userDocRef = db.collection('users').doc(user.uid);
            const userDoc = await userDocRef.get();
            if (userDoc.exists) {
                const userData = userDoc.data();
                const displayName = user.displayName || userData.displayName || 'User';
                if(userNameElement) userNameElement.textContent = `${displayName}`;
                if(memberIdElement) memberIdElement.textContent = `ID: ${userData.memberId || 'N/A'}`;
                const mainBalance = userData.balance !== undefined ? userData.balance : (userData.php_balance !== undefined ? userData.php_balance : (userData.unilevel_income !== undefined ? userData.unilevel_income : 0));
                if(walletBalanceElement) walletBalanceElement.textContent = formatCurrency(mainBalance);
                if(tokenBalanceDisplayElement) tokenBalanceDisplayElement.textContent = formatCurrency(userData.token_balance || userData.emx_token_balance || 0, false); 
            } else {
                if(userNameElement) userNameElement.textContent = `${user.displayName || 'User'}`;
                if(memberIdElement) memberIdElement.textContent = `ID: Not Found`;
            }
        } catch (error) {
            console.error("Error fetching user data:", error);
            if(userNameElement) userNameElement.textContent = `Error`;
        } finally {
            if(pageLoadingElement) pageLoadingElement.classList.add('hidden');
        }
    }
    
    auth.onAuthStateChanged((user) => {
        if (user) {
            fetchAndDisplayUserData(user);
        } else { 
            if(pageLoadingElement) pageLoadingElement.classList.add('hidden');
            if(userNameElement) userNameElement.textContent = 'Guest';
            if(memberIdElement) memberIdElement.textContent = 'ID: N/A';
            if(walletBalanceElement) walletBalanceElement.textContent = formatCurrency(0);
            if(tokenBalanceDisplayElement) tokenBalanceDisplayElement.textContent = formatCurrency(0, false);
            console.log("User is signed out or not authenticated.");
        }
    });

    async function handleSignOut() {
        if (confirm("Are you sure you want to sign out?")) {
            try {
                if(pageLoadingElement) pageLoadingElement.classList.remove('hidden');
                if(pageLoadingElement.querySelector('.loading-text')) pageLoadingElement.querySelector('.loading-text').textContent = 'Signing out...';
                await auth.signOut();
            } catch (error) {
                console.error("Error signing out:", error); 
                alert("Failed to sign out. Please try again.");
                if(pageLoadingElement) pageLoadingElement.classList.add('hidden');
            }
        }
    }

    if(historyButton) historyButton.addEventListener('click', () => alert('History Clicked!'));
    if(connectButton) connectButton.addEventListener('click', () => alert('Connect Clicked!'));
    if(signOutLinkSidebar) signOutLinkSidebar.addEventListener('click', (e) => { e.preventDefault(); handleSignOut(); });
    if(profileMenuIcon) profileMenuIcon.addEventListener('click', () => alert('Profile Menu Icon Clicked! Implement dropdown or navigation.'));

    // --- AI Creator Suite Tool Definitions and Logic ---
    const aiToolContentContainer = document.getElementById('aiToolContentContainer');
    const currentAiToolWrapper = document.getElementById('currentAiToolWrapper');
    const mainContentHeader = document.getElementById('mainContentHeader');
    const apiKeyNotice = document.getElementById('apiKeyNotice');

    function showSpinner(spinnerId) {
        const spinner = currentAiToolWrapper.querySelector(`#${spinnerId}`);
        if (spinner) spinner.style.display = 'block';
    }

    function hideSpinner(spinnerId) {
        const spinner = currentAiToolWrapper.querySelector(`#${spinnerId}`);
        if (spinner) spinner.style.display = 'none';
    }

    function displayOutput(outputId, data, isHtml = false) {
        const outputElement = currentAiToolWrapper.querySelector(`#${outputId}`);
        if(outputElement) {
            if (isHtml) {
                outputElement.innerHTML = data;
            } else {
                outputElement.textContent = data;
            }
            outputElement.style.color = ''; 
        }
    }
    
    function displayError(outputId, error) {
        const outputElement = currentAiToolWrapper.querySelector(`#${outputId}`);
        if(outputElement) {
            outputElement.textContent = `Error: ${error.message || error}`;
            outputElement.style.color = 'red';
        }
    }

    function imagePreview(fileInputId, previewImgId) {
        const input = currentAiToolWrapper.querySelector(`#${fileInputId}`);
        const preview = currentAiToolWrapper.querySelector(`#${previewImgId}`);
        if (input && preview && input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function (e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
            }
            reader.readAsDataURL(input.files[0]);
        } else if (preview) {
            preview.src = "#";
            preview.style.display = 'none';
        }
    }

    async function callLlama3(promptContent, spinnerId, outputId) {
        if (!TOGETHER_API_KEY || TOGETHER_API_KEY === "144f137285e61f4f20c3af158629a0aaee85f131c8a48cd5ffdd0e6477898407") { // Check against actual key if it's a placeholder
             // No error display here if key is valid
        } else if (TOGETHER_API_KEY === "144f137285e61f4f20c3af158629a0aaee85f131c8a48cd5ffdd0e6477898407"){
             displayError(outputId, "Together API Key not configured. Please set it in the script.");
             return;
        }
        showSpinner(spinnerId);
        displayOutput(outputId, ''); 

        try {
            const response = await fetch("https://api.together.xyz/v1/chat/completions", {
                method: "POST",
                headers: { "Authorization": `Bearer ${TOGETHER_API_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: "meta-llama/Llama-3.3-70B-Instruct-Turbo-Free", // Use specified FREE model
                    messages: [{ role: "user", content: promptContent }], max_tokens: 512, temperature: 0.7,
                })
            });
            if (!response.ok) { const errData = await response.json(); throw new Error(`API Error (${response.status}): ${errData.error?.message || 'Unknown error'}`); }
            const data = await response.json();
            const resultText = data.choices?.[0]?.message?.content?.trim() || "No content received.";
            displayOutput(outputId, resultText);
        } catch (error) { console.error("Llama 3 API call failed:", error); displayError(outputId, error); } 
        finally { hideSpinner(spinnerId); }
    }

    async function callLlamaVision(imageBase64, promptContent, spinnerId, outputId, previewImgHTML = '') {
         if (!TOGETHER_API_KEY || TOGETHER_API_KEY === "144f137285e61f4f20c3af158629a0aaee85f131c8a48cd5ffdd0e6477898407") {
            // Key is set, proceed
        } else if (TOGETHER_API_KEY === "144f137285e61f4f20c3af158629a0aaee85f131c8a48cd5ffdd0e6477898407") {
            displayError(outputId, "Together API Key not configured.");
            return;
        }
        showSpinner(spinnerId);
        const outputElement = currentAiToolWrapper.querySelector(`#${outputId}`);
        if (outputElement) outputElement.innerHTML = previewImgHTML;

        try {
            const response = await fetch("https://api.together.xyz/v1/chat/completions", {
                method: "POST",
                headers: { "Authorization": `Bearer ${TOGETHER_API_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: "meta-llama/Llama-Vision-Free", // Use specified FREE vision model
                    messages: [{ role: "user", content: [{ type: "image_url", image_url: { url: imageBase64 } }, { type: "text", text: promptContent }] }],
                    max_tokens: 300
                })
            });
            if (!response.ok) { const errData = await response.json(); throw new Error(`API Error (${response.status}): ${errData.error?.message || 'Unknown error'}`); }
            const data = await response.json();
            const resultText = data.choices?.[0]?.message?.content?.trim() || "No description received.";
            
            if (outputElement) {
                const textNode = document.createElement('div');
                textNode.textContent = resultText;
                outputElement.appendChild(textNode);
            } else {
                displayOutput(outputId, resultText);
            }

        } catch (error) { console.error("Llama Vision API call failed:", error); displayError(outputId, error); } 
        finally { hideSpinner(spinnerId); }
    }

    async function callFluxImageGeneration(prompt, spinnerId, outputId) {
        if (!TOGETHER_API_KEY || TOGETHER_API_KEY === "144f137285e61f4f20c3af158629a0aaee85f131c8a48cd5ffdd0e6477898407") {
            // Key is set, proceed
        } else if (TOGETHER_API_KEY === "144f137285e61f4f20c3af158629a0aaee85f131c8a48cd5ffdd0e6477898407") {
            displayError(outputId, "Together API Key not configured.");
            return;
        }
        showSpinner(spinnerId);
        const outputElement = currentAiToolWrapper.querySelector(`#${outputId}`);
        if(outputElement) outputElement.innerHTML = '';

        try {
            const response = await fetch("https://api.together.xyz/v1/images/generations", {
                method: "POST",
                headers: { "Authorization": `Bearer ${TOGETHER_API_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: "black-forest-labs/FLUX.1-schnell-Free", // Use specified FREE image model
                    prompt: prompt, width: 512, height: 512, steps: 4, n: 1, response_format: "b64_json" // Corrected steps to 4
                })
            });
            if (!response.ok) { const errData = await response.json(); throw new Error(`API Error (${response.status}): ${errData.error?.message || 'Unknown error'}`); }
            const data = await response.json();
            if (data.data?.[0]?.b64_json && outputElement) {
                const imgElement = document.createElement('img');
                imgElement.src = `data:image/png;base64,${data.data[0].b64_json}`;
                imgElement.alt = prompt;
                imgElement.classList.add('mx-auto', 'my-2', 'rounded-md', 'border', 'border-gray-300');
                outputElement.appendChild(imgElement);
            } else { displayOutput(outputId, "No image data received."); }
        } catch (error) { console.error("Image Generation API call failed:", error); displayError(outputId, error); } 
        finally { hideSpinner(spinnerId); }
    }
    
    async function callDeepgramSTT(audioFile, spinnerId, outputId) {
        if (!DEEPGRAM_API_KEY || DEEPGRAM_API_KEY === "5431a4360985a2cd68978b3b2908c13bca576830") {
             // Key is set, proceed
        } else if (DEEPGRAM_API_KEY === "5431a4360985a2cd68978b3b2908c13bca576830") {
            displayError(outputId, "Deepgram API Key not configured.");
            return null;
        }
        showSpinner(spinnerId);
        displayOutput(outputId, '');

        try {
            const response = await fetch("https://api.deepgram.com/v1/listen?smart_format=true&punctuate=true&paragraphs=true&model=nova-2", {
                method: "POST", headers: { "Authorization": `Token ${DEEPGRAM_API_KEY}` }, body: audioFile
            });
            if (!response.ok) { const errData = await response.json(); throw new Error(`API Error (${response.status}): ${errData.err_msg || errData.reason || 'Unknown error'}`); }
            const data = await response.json();
            const transcript = data.results?.channels[0]?.alternatives[0]?.transcript || "No transcript found.";
            displayOutput(outputId, transcript);
            return transcript; 
        } catch (error) { console.error("Deepgram STT API call failed:", error); displayError(outputId, error); return null; } 
        finally { hideSpinner(spinnerId); }
    }

    async function callDeepgramTTS(text, spinnerId, outputId) {
         if (!DEEPGRAM_API_KEY || DEEPGRAM_API_KEY === "5431a4360985a2cd68978b3b2908c13bca576830") {
            // Key is set, proceed
        } else if (DEEPGRAM_API_KEY === "5431a4360985a2cd68978b3b2908c13bca576830") {
            displayError(outputId, "Deepgram API Key not configured.");
            return;
        }
        showSpinner(spinnerId);
        const outputElement = currentAiToolWrapper.querySelector(`#${outputId}`);
        if (outputElement) outputElement.innerHTML = '';

        try {
            const response = await fetch("https://api.deepgram.com/v1/speak?model=aura-asteria-en", {
                method: "POST", headers: { "Authorization": `Token ${DEEPGRAM_API_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({ text: text })
            });
            if (!response.ok) { 
                let errorMsg = 'Unknown TTS error';
                try { const errorData = await response.json(); errorMsg = errorData.err_msg || errorData.reason || JSON.stringify(errorData); }
                catch(e) { errorMsg = await response.text(); }
                throw new Error(`API Error (${response.status}): ${errorMsg}`);
            }
            const audioBlob = await response.blob();
            const audioUrl = URL.createObjectURL(audioBlob);
            const audioElement = document.createElement('audio');
            audioElement.controls = true; audioElement.src = audioUrl;
            if (outputElement) outputElement.appendChild(audioElement);
        } catch (error) { console.error("Deepgram TTS API call failed:", error); displayError(outputId, error); } 
        finally { hideSpinner(spinnerId); }
    }
    
    async function callDeepgramRead(text, features, spinnerId, outputId) {
        if (!DEEPGRAM_API_KEY || DEEPGRAM_API_KEY === "5431a4360985a2cd68978b3b2908c13bca576830") {
             // Key is set, proceed
        } else if (DEEPGRAM_API_KEY === "5431a4360985a2cd68978b3b2908c13bca576830") {
            displayError(outputId, "Deepgram API Key not configured.");
            return null;
        }
        showSpinner(spinnerId);
        displayOutput(outputId, '');

        let queryParams = Object.entries(features)
            .map(([key, value]) => value === true ? `${key === 'summarize' ? 'summarize=v2' : key + '=true'}&` : "")
            .join('') + "language=en";

        try {
            const response = await fetch(`https://api.deepgram.com/v1/read?${queryParams}`, {
                method: "POST", headers: { "Authorization": `Token ${DEEPGRAM_API_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({ text: text })
            });
            if (!response.ok) { const errData = await response.json(); throw new Error(`API Error (${response.status}): ${errData.err_msg || errData.reason || 'Unknown error'}`); }
            const data = await response.json();
            displayOutput(outputId, JSON.stringify(data.results, null, 2));
            return data.results;
        } catch (error) { console.error("Deepgram Read API call failed:", error); displayError(outputId, error); return null; } 
        finally { hideSpinner(spinnerId); }
    }

    function fileToBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });
    }

    const aiCreatorToolsDefinitions = [
        {
            id: 'blogIdeaGenerator', title: 'Blog Post Idea Generator', icon: 'fas fa-lightbulb',
            html: () => `
                <h3>1. Quick Blog Post Idea Generator</h3>
                <label for="blogTopic" class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">Enter a keyword or topic:</label>
                <input type="text" id="blogTopic" placeholder="e.g., Sustainable Living" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                <button onclick="aiTool_generateBlogIdeas()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-500 dark:hover:bg-blue-600">Generate Ideas</button>
                <div class="spinner" id="blogIdeaSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="blogIdeaOutput"></div>`,
            action: async function aiTool_generateBlogIdeas() {
                const topic = currentAiToolWrapper.querySelector('#blogTopic').value;
                if (!topic) { alert("Please enter a topic."); return; }
                const prompt = `Generate 5 engaging blog post titles and a brief (1-2 sentence) concept for each, based on the topic: "${topic}". Format as a numbered list. Title: [Title] - Concept: [Concept]`;
                await callLlama3(prompt, 'blogIdeaSpinner', 'blogIdeaOutput');
            }
        },
        {
            id: 'captionWriter', title: 'Social Media Caption Writer', icon: 'fas fa-share-square',
            html: () => `
                <h3>2. Social Media Caption Writer</h3>
                <label for="captionTopic" class="block mb-2 text-sm font-medium">Brief description or topic:</label>
                <input type="text" id="captionTopic" placeholder="e.g., My new travel photo" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                <label for="captionPlatform" class="block mt-3 mb-2 text-sm font-medium">Platform:</label>
                <select id="captionPlatform" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                    <option value="Instagram">Instagram</option> <option value="Twitter (X)">Twitter (X)</option> <option value="LinkedIn">LinkedIn</option> <option value="Facebook">Facebook</option>
                </select>
                <button onclick="aiTool_generateCaptions()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Generate Captions</button>
                <div class="spinner" id="captionSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="captionOutput"></div>`,
            action: async function aiTool_generateCaptions() {
                const topic = currentAiToolWrapper.querySelector('#captionTopic').value;
                const platform = currentAiToolWrapper.querySelector('#captionPlatform').value;
                if (!topic) { alert("Please enter a topic."); return; }
                const prompt = `Write 3 social media captions for ${platform} based on the topic: "${topic}". Include relevant emojis and suggest 2-3 hashtags for each. Make them engaging and suitable for the platform.`;
                await callLlama3(prompt, 'captionSpinner', 'captionOutput');
            }
        },
        {
            id: 'hookCreator', title: 'Video Script Hook Creator', icon: 'fas fa-film',
            html: () => `
                <h3>3. Video Script Hook Creator</h3>
                <label for="hookTopic" class="block mb-2 text-sm font-medium">Video topic:</label>
                <input type="text" id="hookTopic" placeholder="e.g., 10 productivity hacks" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                <button onclick="aiTool_generateHooks()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Generate Hooks</button>
                <div class="spinner" id="hookSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="hookOutput"></div>`,
            action: async function aiTool_generateHooks() {
                const topic = currentAiToolWrapper.querySelector('#hookTopic').value;
                if (!topic) { alert("Please enter a video topic."); return; }
                const prompt = `Generate 3-5 compelling opening hooks (1-2 sentences each) for a video about "${topic}". These hooks should grab the viewer's attention immediately.`;
                await callLlama3(prompt, 'hookSpinner', 'hookOutput');
            }
        },
        {
            id: 'promptEnhancer', title: 'Image Prompt Enhancer', icon: 'fas fa-magic',
            html: () => `
                <h3>4. Basic Image Prompt Enhancer</h3>
                <label for="simplePrompt" class="block mb-2 text-sm font-medium">Enter your simple image prompt:</label>
                <input type="text" id="simplePrompt" placeholder="e.g., cat on a roof" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                <button onclick="aiTool_enhancePrompt()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Enhance Prompt</button>
                <div class="spinner" id="promptEnhancerSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="promptEnhancerOutput"></div>`,
            action: async function aiTool_enhancePrompt() {
                const simplePrompt = currentAiToolWrapper.querySelector('#simplePrompt').value;
                if (!simplePrompt) { alert("Please enter a simple prompt."); return; }
                const prompt = `Given the simple image generation prompt: "${simplePrompt}", enhance it to be more descriptive and likely to produce a better image. Provide 3 variations. Focus on adding details about style, lighting, composition, and mood.`;
                await callLlama3(prompt, 'promptEnhancerSpinner', 'promptEnhancerOutput');
            }
        },
        {
            id: 'imageDescriber', title: 'Image Describer', icon: 'far fa-eye',
            html: () => `
                <h3>5. "What's in this Image?" Describer</h3>
                <label for="imageToDescribe" class="block mb-2 text-sm font-medium">Upload an image:</label>
                <input type="file" id="imageToDescribe" accept="image/*" onchange="imagePreview('imageToDescribe', 'imageDescriberPreview')" class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 p-2">
                <img id="imageDescriberPreview" src="#" alt="Image preview" style="display:none; max-width: 200px; margin:10px 0;" class="rounded-md border"/>
                <button onclick="aiTool_describeImage()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Describe Image</button>
                <div class="spinner" id="imageDescriberSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="imageDescriberOutput"></div>`,
            action: async function aiTool_describeImage() {
                const fileInput = currentAiToolWrapper.querySelector('#imageToDescribe');
                if (!fileInput.files.length) { alert("Please upload an image."); return; }
                const imageFile = fileInput.files[0];
                const imageBase64 = await fileToBase64(imageFile);
                const prompt = "Describe this image in detail. What are the main objects, setting, colors, and any notable features?";
                const previewImgHTML = currentAiToolWrapper.querySelector('#imageDescriberPreview').outerHTML;
                await callLlamaVision(imageBase64, prompt, 'imageDescriberSpinner', 'imageDescriberOutput', previewImgHTML);
            }
        },
        {
            id: 'imageGenerator', title: 'Simple Image Generator', icon: 'far fa-image',
            html: () => `
                <h3>6. Simple Image Generator</h3>
                <label for="imageGenPrompt" class="block mb-2 text-sm font-medium">Enter your image prompt:</label>
                <input type="text" id="imageGenPrompt" placeholder="e.g., A futuristic cityscape at sunset" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                <button onclick="aiTool_generateImage()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Generate Image</button>
                <div class="spinner" id="imageGeneratorSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="imageGeneratorOutput"></div>`,
            action: async function aiTool_generateImage() {
                const prompt = currentAiToolWrapper.querySelector('#imageGenPrompt').value;
                if (!prompt) { alert("Please enter an image prompt."); return; }
                await callFluxImageGeneration(prompt, 'imageGeneratorSpinner', 'imageGeneratorOutput');
            }
        },
        {
            id: 'podcastTitleSuggester', title: 'Podcast Title Suggester', icon: 'fas fa-podcast',
            html: () => `
                <h3>7. Podcast Episode Title Suggester</h3>
                <label for="podcastTopic" class="block mb-2 text-sm font-medium">Episode topic or summary:</label>
                <input type="text" id="podcastTopic" placeholder="e.g., Interview with a tech innovator" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                <button onclick="aiTool_suggestPodcastTitles()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Suggest Titles</button>
                <div class="spinner" id="podcastTitleSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="podcastTitleOutput"></div>`,
            action: async function aiTool_suggestPodcastTitles() {
                const topic = currentAiToolWrapper.querySelector('#podcastTopic').value;
                if (!topic) { alert("Please enter a podcast topic or summary."); return; }
                const prompt = `Generate 5 creative and engaging podcast episode titles for a show about: "${topic}".`;
                await callLlama3(prompt, 'podcastTitleSpinner', 'podcastTitleOutput');
            }
        },
        {
            id: 'emailSubjectGenerator', title: 'Email Subject Generator', icon: 'fas fa-envelope-open-text',
             html: () => `
                <h3>8. Email Subject Line Generator</h3>
                <label for="emailContentSummary" class="block mb-2 text-sm font-medium">Email content summary or goal:</label>
                <input type="text" id="emailContentSummary" placeholder="e.g., Announcing new product feature" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                <button onclick="aiTool_generateEmailSubjects()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Generate Subjects</button>
                <div class="spinner" id="emailSubjectSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="emailSubjectOutput"></div>`,
            action: async function aiTool_generateEmailSubjects() {
                const summary = currentAiToolWrapper.querySelector('#emailContentSummary').value;
                if (!summary) { alert("Please enter an email content summary or goal."); return; }
                const prompt = `Generate 5 compelling email subject lines for an email with the following content/goal: "${summary}". Aim for high open rates.`;
                await callLlama3(prompt, 'emailSubjectSpinner', 'emailSubjectOutput');
            }
        },
        {
            id: 'audioTranscriber', title: 'Audio Note Transcriber', icon: 'fas fa-file-audio',
            html: () => `
                <h3>9. Audio Note Transcriber</h3>
                <label for="audioToTranscribe" class="block mb-2 text-sm font-medium">Upload an audio file (WAV, MP3, etc.):</label>
                <input type="file" id="audioToTranscribe" accept="audio/*" class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 p-2">
                <button onclick="aiTool_transcribeAudio()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Transcribe Audio</button>
                <div class="spinner" id="audioTranscriberSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="audioTranscriberOutput"></div>`,
            action: async function aiTool_transcribeAudio() {
                const fileInput = currentAiToolWrapper.querySelector('#audioToTranscribe');
                if (!fileInput.files.length) { alert("Please upload an audio file."); return; }
                await callDeepgramSTT(fileInput.files[0], 'audioTranscriberSpinner', 'audioTranscriberOutput');
            }
        },
        {
            id: 'ttsAnnouncer', title: 'Text-to-Speech Announcer', icon: 'fas fa-bullhorn',
            html: () => `
                <h3>10. Text-to-Speech Announcer</h3>
                <label for="textToSpeak" class="block mb-2 text-sm font-medium">Enter text to convert to speech:</label>
                <textarea id="textToSpeak" rows="3" placeholder="Hello, this is a test of text to speech." class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"></textarea>
                <button onclick="aiTool_speakText()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Speak Text</button>
                <div class="spinner" id="ttsAnnouncerSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="ttsAnnouncerOutput"></div>`,
            action: async function aiTool_speakText() {
                const text = currentAiToolWrapper.querySelector('#textToSpeak').value;
                if (!text) { alert("Please enter text to speak."); return; }
                await callDeepgramTTS(text, 'ttsAnnouncerSpinner', 'ttsAnnouncerOutput');
            }
        },
        {
            id: 'sceneSummarizer', title: 'Video Script Scene Summarizer', icon: 'fas fa-align-left',
            html: () => `
                <h3>11. Video Script Scene Summarizer</h3>
                <label for="scriptScene" class="block mb-2 text-sm font-medium">Paste script scene:</label>
                <textarea id="scriptScene" rows="5" placeholder="INT. COFFEE SHOP - DAY..." class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"></textarea>
                <button onclick="aiTool_summarizeScene()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Summarize Scene</button>
                <div class="spinner" id="sceneSummarizerSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="sceneSummarizerOutput"></div>`,
            action: async function aiTool_summarizeScene() {
                const sceneText = currentAiToolWrapper.querySelector('#scriptScene').value;
                if (!sceneText) { alert("Please paste a script scene."); return; }
                const prompt = `Summarize the following video script scene in 1-2 sentences, focusing on the key actions and dialogue points:\n\n${sceneText}`;
                await callLlama3(prompt, 'sceneSummarizerSpinner', 'sceneSummarizerOutput');
            }
        },
        {
            id: 'audioSentimentChecker', title: 'Audio Sentiment Checker', icon: 'fas fa-smile-beam',
            html: () => `
                <h3>12. Simple Audio Sentiment Checker</h3>
                <label for="audioForSentiment" class="block mb-2 text-sm font-medium">Upload audio for sentiment analysis:</label>
                <input type="file" id="audioForSentiment" accept="audio/*" class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 p-2">
                <button onclick="aiTool_checkAudioSentiment()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Check Sentiment</button>
                <div class="spinner" id="audioSentimentSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="audioSentimentOutput"></div>`,
            action: async function aiTool_checkAudioSentiment() {
                const fileInput = currentAiToolWrapper.querySelector('#audioForSentiment');
                if (!fileInput.files.length) { alert("Please upload an audio file."); return; }
                const transcript = await callDeepgramSTT(fileInput.files[0], 'audioSentimentSpinner', 'audioSentimentOutput'); 
                if (transcript) {
                    await callDeepgramRead(transcript, { sentiment: true }, 'audioSentimentSpinner', 'audioSentimentOutput');
                } else {
                    hideSpinner('audioSentimentSpinner'); 
                }
            }
        },
        {
            id: 'audioTopicExtractor', title: 'Key Topics from Audio', icon: 'fas fa-tags',
            html: () => `
                <h3>13. Key Topics from Audio Extractor</h3>
                <label for="audioForTopics" class="block mb-2 text-sm font-medium">Upload audio to extract topics:</label>
                <input type="file" id="audioForTopics" accept="audio/*" class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 p-2">
                <button onclick="aiTool_extractAudioTopics()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Extract Topics</button>
                <div class="spinner" id="audioTopicSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="audioTopicOutput"></div>`,
            action: async function aiTool_extractAudioTopics() {
                const fileInput = currentAiToolWrapper.querySelector('#audioForTopics');
                if (!fileInput.files.length) { alert("Please upload an audio file."); return; }
                const transcript = await callDeepgramSTT(fileInput.files[0], 'audioTopicSpinner', 'audioTopicOutput');
                if (transcript) {
                    await callDeepgramRead(transcript, { topics: true }, 'audioTopicSpinner', 'audioTopicOutput');
                } else {
                    hideSpinner('audioTopicSpinner');
                }
            }
        },
         {
            id: 'paraphraser', title: 'Content Paraphraser', icon: 'fas fa-random',
            html: () => `
                <h3>14. Content Paraphraser</h3>
                <label for="textToParaphrase" class="block mb-2 text-sm font-medium">Paste text to paraphrase:</label>
                <textarea id="textToParaphrase" rows="5" placeholder="The quick brown fox jumps over the lazy dog." class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"></textarea>
                <button onclick="aiTool_paraphraseText()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Paraphrase</button>
                <div class="spinner" id="paraphraserSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="paraphraserOutput"></div>`,
            action: async function aiTool_paraphraseText() {
                const text = currentAiToolWrapper.querySelector('#textToParaphrase').value;
                if (!text) { alert("Please enter text to paraphrase."); return; }
                const prompt = `Paraphrase the following text, maintaining its original meaning but using different wording and sentence structure:\n\n${text}`;
                await callLlama3(prompt, 'paraphraserSpinner', 'paraphraserOutput');
            }
        },
        {
            id: 'textSummarizer', title: 'Text Summarizer', icon: 'fas fa-compress-arrows-alt',
            html: () => `
                <h3>15. Text Summarizer (Short Text)</h3>
                <label for="textToSummarize" class="block mb-2 text-sm font-medium">Paste text to summarize (a few paragraphs):</label>
                <textarea id="textToSummarize" rows="7" placeholder="Enter your text here..." class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"></textarea>
                <button onclick="aiTool_summarizeShortText()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Summarize Text</button>
                <div class="spinner" id="textSummarizerSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="textSummarizerOutput"></div>`,
            action: async function aiTool_summarizeShortText() {
                const text = currentAiToolWrapper.querySelector('#textToSummarize').value;
                if (!text) { alert("Please enter text to summarize."); return; }
                const prompt = `Summarize the following text concisely (around 2-3 sentences or a short paragraph if the text is longer):\n\n${text}`;
                await callLlama3(prompt, 'textSummarizerSpinner', 'textSummarizerOutput');
            }
        },
        {
            id: 'grammarToneChecker', title: 'Grammar & Tone Check', icon: 'fas fa-spell-check',
            html: () => `
                <h3>16. Grammar & Tone Quick Check</h3>
                <label for="textForGrammarTone" class="block mb-2 text-sm font-medium">Paste text for grammar & tone check:</label>
                <textarea id="textForGrammarTone" rows="5" placeholder="Their going to the park. Its a beautiful day!" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"></textarea>
                <button onclick="aiTool_checkGrammarTone()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Check Text</button>
                <div class="spinner" id="grammarToneSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="grammarToneOutput"></div>`,
            action: async function aiTool_checkGrammarTone() {
                const text = currentAiToolWrapper.querySelector('#textForGrammarTone').value;
                if (!text) { alert("Please enter text to check."); return; }
                const prompt = `Analyze the following text for grammar errors and assess its overall tone. Provide corrections for grammar and suggest if the tone is (e.g., formal, informal, friendly, assertive, etc.). If there are errors, list them and provide corrected versions. Text:\n\n"${text}"`;
                await callLlama3(prompt, 'grammarToneSpinner', 'grammarToneOutput');
            }
        },
        {
            id: 'altTextGenerator', title: 'Image Alt-Text Generator', icon: 'fas fa-closed-captioning',
            html: () => `
                <h3>17. Image Alt-Text Generator</h3>
                <label for="imageForAltText" class="block mb-2 text-sm font-medium">Upload image for alt-text:</label>
                <input type="file" id="imageForAltText" accept="image/*" onchange="imagePreview('imageForAltText', 'altTextPreview')" class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 p-2">
                <img id="altTextPreview" src="#" alt="Image preview" style="display:none; max-width: 200px; margin:10px 0;" class="rounded-md border"/>
                <button onclick="aiTool_generateAltText()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Generate Alt-Text</button>
                <div class="spinner" id="altTextSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="altTextOutput"></div>`,
            action: async function aiTool_generateAltText() {
                const fileInput = currentAiToolWrapper.querySelector('#imageForAltText');
                if (!fileInput.files.length) { alert("Please upload an image."); return; }
                const imageFile = fileInput.files[0];
                const imageBase64 = await fileToBase64(imageFile);
                const previewImgHTML = currentAiToolWrapper.querySelector('#altTextPreview').outerHTML;
                
                showSpinner('altTextSpinner');
                const outputElement = currentAiToolWrapper.querySelector('#altTextOutput');
                if(outputElement) outputElement.innerHTML = previewImgHTML;

                try {
                    const visionResponse = await fetch("https://api.together.xyz/v1/chat/completions", {
                        method: "POST", headers: { "Authorization": `Bearer ${TOGETHER_API_KEY}`, "Content-Type": "application/json" },
                        body: JSON.stringify({ model: "meta-llama/Llama-Vision-Free", messages: [{ role: "user", content: [{ type: "image_url", image_url: { url: imageBase64 } }, { type: "text", text: "Briefly describe this image for alt text." }] }], max_tokens: 100 })
                    });
                    if (!visionResponse.ok) throw new Error('Llama Vision failed');
                    const visionData = await visionResponse.json();
                    const description = visionData.choices?.[0]?.message?.content?.trim() || "Could not describe image.";

                    const altTextPrompt = `Convert the following image description into concise and effective alt text: "${description}"`;
                    const llamaResponse = await fetch("https://api.together.xyz/v1/chat/completions", {
                        method: "POST", headers: { "Authorization": `Bearer ${TOGETHER_API_KEY}`, "Content-Type": "application/json" },
                        body: JSON.stringify({ model: "meta-llama/Llama-3.3-70B-Instruct-Turbo-Free", messages: [{ role: "user", content: altTextPrompt }], max_tokens: 50 })
                    });
                    if (!llamaResponse.ok) throw new Error('Llama 3 for alt text failed');
                    const llamaData = await llamaResponse.json();
                    const altText = llamaData.choices?.[0]?.message?.content?.trim() || description;
                    
                    if(outputElement) { const textNode = document.createElement('div'); textNode.textContent = altText; outputElement.appendChild(textNode); }
                    else { displayOutput('altTextOutput', altText); }

                } catch (error) { console.error("Alt-text generation failed:", error); displayError('altTextOutput', error); } 
                finally { hideSpinner('altTextSpinner'); }
            }
        },
        {
            id: 'keywordExtractor', title: 'Keyword Extractor', icon: 'fas fa-key',
            html: () => `
                <h3>18. Keyword Extractor from Text</h3>
                <label for="textForKeywords" class="block mb-2 text-sm font-medium">Paste text to extract keywords:</label>
                <textarea id="textForKeywords" rows="5" placeholder="Artificial intelligence is transforming various industries..." class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"></textarea>
                <button onclick="aiTool_extractKeywords()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Extract Keywords</button>
                <div class="spinner" id="keywordExtractorSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="keywordExtractorOutput"></div>`,
            action: async function aiTool_extractKeywords() {
                const text = currentAiToolWrapper.querySelector('#textForKeywords').value;
                if (!text) { alert("Please enter text to extract keywords from."); return; }
                const prompt = `Extract the main keywords and key phrases (up to 10) from the following text. List them clearly:\n\n${text}`;
                await callLlama3(prompt, 'keywordExtractorSpinner', 'keywordExtractorOutput');
            }
        },
        {
            id: 'readabilityEstimator', title: 'Readability Estimator', icon: 'fas fa-glasses',
            html: () => `
                <h3>19. Content Readability Score Estimator</h3>
                <label for="textForReadability" class="block mb-2 text-sm font-medium">Paste text to estimate readability:</label>
                <textarea id="textForReadability" rows="5" placeholder="Enter text to analyze its complexity..." class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"></textarea>
                <button onclick="aiTool_estimateReadability()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Estimate Readability</button>
                <div class="spinner" id="readabilitySpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="readabilityOutput"></div>`,
            action: async function aiTool_estimateReadability() {
                const text = currentAiToolWrapper.querySelector('#textForReadability').value;
                if (!text) { alert("Please enter text."); return; }
                const prompt = `Analyze the following text and provide an estimated Flesch-Kincaid Grade Level. Also, give a brief (1-2 sentence) qualitative assessment of its readability (e.g., "Easy to read for a general audience", "Requires a high level of technical understanding"). Text:\n\n"${text}"`;
                await callLlama3(prompt, 'readabilitySpinner', 'readabilityOutput');
            }
        },
        {
            id: 'textSentimentChecker', title: 'Text Sentiment Checker', icon: 'far fa-grin-stars',
            html: () => `
                <h3>20. Sentiment Checker for Text Snippets</h3>
                <label for="textForSentiment" class="block mb-2 text-sm font-medium">Paste text snippet for sentiment analysis:</label>
                <input type="text" id="textForSentiment" placeholder="e.g., I love this product!" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                <button onclick="aiTool_checkTextSentiment()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Check Sentiment</button>
                <div class="spinner" id="textSentimentSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="textSentimentOutput"></div>`,
            action: async function aiTool_checkTextSentiment() {
                const text = currentAiToolWrapper.querySelector('#textForSentiment').value;
                if (!text) { alert("Please enter text for sentiment analysis."); return; }
                await callDeepgramRead(text, { sentiment: true }, 'textSentimentSpinner', 'textSentimentOutput');
            }
        },
        {
            id: 'tweetFromBlog', title: 'Tweet Snippet Creator', icon: 'fab fa-twitter',
            html: () => `
                <h3>21. "Tweet from Blog Post" Snippet Creator</h3>
                <label for="blogParagraphForTweet" class="block mb-2 text-sm font-medium">Paste a paragraph from your blog post:</label>
                <textarea id="blogParagraphForTweet" rows="5" placeholder="One key takeaway is that..." class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"></textarea>
                <button onclick="aiTool_generateTweetsFromParagraph()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Generate Tweets</button>
                <div class="spinner" id="tweetFromBlogSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="tweetFromBlogOutput"></div>`,
            action: async function aiTool_generateTweetsFromParagraph() {
                const paragraph = currentAiToolWrapper.querySelector('#blogParagraphForTweet').value;
                if (!paragraph) { alert("Please paste a paragraph."); return; }
                const prompt = `Take the following paragraph and generate 2-3 tweet options (under 280 characters each) that summarize its key point or offer an engaging hook related to it. Include 1-2 relevant hashtags for each tweet.\n\nParagraph: "${paragraph}"`;
                await callLlama3(prompt, 'tweetFromBlogSpinner', 'tweetFromBlogOutput');
            }
        },
        {
            id: 'quoteFinder', title: 'Quote Finder from Text', icon: 'fas fa-quote-left',
             html: () => `
                <h3>22. Quote Finder from Text</h3>
                <label for="textForQuotes" class="block mb-2 text-sm font-medium">Paste text to find quotable sentences:</label>
                <textarea id="textForQuotes" rows="7" placeholder="Enter a larger block of text here..." class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"></textarea>
                <button onclick="aiTool_findQuotes()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Find Quotes</button>
                <div class="spinner" id="quoteFinderSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="quoteFinderOutput"></div>`,
            action: async function aiTool_findQuotes() {
                const text = currentAiToolWrapper.querySelector('#textForQuotes').value;
                if (!text) { alert("Please paste text to find quotes from."); return; }
                const prompt = `From the following text, extract 3-5 impactful or highly quotable sentences. Present them as a list.\n\nText:\n${text}`;
                await callLlama3(prompt, 'quoteFinderSpinner', 'quoteFinderOutput');
            }
        },
        {
            id: 'faqGenerator', title: 'FAQ Generator', icon: 'fas fa-question-circle',
            html: () => `
                <h3>23. FAQ Generator from Content</h3>
                <label for="contentForFaqs" class="block mb-2 text-sm font-medium">Paste content to generate FAQs from:</label>
                <textarea id="contentForFaqs" rows="7" placeholder="Enter your article or product description..." class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"></textarea>
                <button onclick="aiTool_generateFaqs()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Generate FAQs</button>
                <div class="spinner" id="faqGeneratorSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="faqGeneratorOutput"></div>`,
            action: async function aiTool_generateFaqs() {
                const content = currentAiToolWrapper.querySelector('#contentForFaqs').value;
                if (!content) { alert("Please paste content."); return; }
                const prompt = `Based on the following content, generate a list of 3-5 frequently asked questions (FAQs) along with their concise answers derived from the text. Format as: Q: [Question]\nA: [Answer]\n\nContent:\n${content}`;
                await callLlama3(prompt, 'faqGeneratorSpinner', 'faqGeneratorOutput');
            }
        },
        {
            id: 'colorPaletteGenerator', title: 'Image Color Palette', icon: 'fas fa-palette',
            html: () => `
                <h3>24. Image to Color Palette Generator</h3>
                <label for="imageForPalette" class="block mb-2 text-sm font-medium">Upload image to extract color palette:</label>
                <input type="file" id="imageForPalette" accept="image/*" onchange="imagePreview('imageForPalette', 'colorPalettePreview')" class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 p-2">
                <img id="colorPalettePreview" src="#" alt="Image preview" style="display:none; max-width: 200px; margin:10px 0;" class="rounded-md border"/>
                <button onclick="aiTool_generateColorPalette()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Extract Palette</button>
                <div class="spinner" id="colorPaletteSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="colorPaletteOutput">
                    <div id="paletteSwatches" class="flex flex-wrap gap-2 mt-2"></div>
                </div>`,
            action: async function aiTool_generateColorPalette() {
                const fileInput = currentAiToolWrapper.querySelector('#imageForPalette');
                if (!fileInput.files.length) { alert("Please upload an image."); return; }
                const imageFile = fileInput.files[0];
                const imageBase64 = await fileToBase64(imageFile);
                
                const outputElement = currentAiToolWrapper.querySelector('#colorPaletteOutput');
                const previewImgHTML = currentAiToolWrapper.querySelector('#colorPalettePreview').outerHTML;
                const paletteSwatchesDiv = currentAiToolWrapper.querySelector('#paletteSwatches');
                
                showSpinner('colorPaletteSpinner');
                if (paletteSwatchesDiv) paletteSwatchesDiv.innerHTML = ''; 
                if (outputElement) outputElement.innerHTML = previewImgHTML + '<div id="paletteSwatches" class="flex flex-wrap gap-2 mt-2"></div>'; 

                try {
                    const visionPrompt = "Identify up to 5 dominant colors in this image. List their hex codes if possible, or describe them clearly (e.g., 'deep blue', 'bright yellow').";
                    const visionResponse = await fetch("https://api.together.xyz/v1/chat/completions", {
                        method: "POST", headers: { "Authorization": `Bearer ${TOGETHER_API_KEY}`, "Content-Type": "application/json" },
                        body: JSON.stringify({ model: "meta-llama/Llama-Vision-Free", messages: [{ role: "user", content: [{ type: "image_url", image_url: { url: imageBase64 } }, { type: "text", text: visionPrompt }] }], max_tokens: 150 })
                    });
                    if (!visionResponse.ok) throw new Error('Llama Vision for colors failed');
                    const visionData = await visionResponse.json();
                    const colorDescription = visionData.choices?.[0]?.message?.content?.trim() || "Could not identify colors.";

                    const parsePrompt = `From the following description of image colors, extract actual hex color codes (e.g., #FF0000) or common CSS color names (e.g., red, skyblue). List up to 5. If no hex codes are present, try to infer them from descriptions. Description: "${colorDescription}"`;
                    const llamaResponse = await fetch("https://api.together.xyz/v1/chat/completions", { 
                        method: "POST", headers: { "Authorization": `Bearer ${TOGETHER_API_KEY}`, "Content-Type": "application/json" },
                        body: JSON.stringify({ model: "meta-llama/Llama-3.3-70B-Instruct-Turbo-Free", messages: [{ role: "user", content: parsePrompt }], max_tokens: 100 })
                    });
                    if (!llamaResponse.ok) throw new Error('Llama 3 for color parsing failed');
                    const llamaData = await llamaResponse.json();
                    const extractedColorsText = llamaData.choices?.[0]?.message?.content?.trim() || "";
                    
                    const colors = extractedColorsText.match(/#([0-9A-Fa-f]{6}|[0-9A-Fa-f]{3})|\b(AliceBlue|AntiqueWhite|Aqua|Aquamarine|Azure|Beige|Bisque|Black|BlanchedAlmond|Blue|BlueViolet|Brown|BurlyWood|CadetBlue|Chartreuse|Chocolate|Coral|CornflowerBlue|Cornsilk|Crimson|Cyan|DarkBlue|DarkCyan|DarkGoldenRod|DarkGray|DarkGrey|DarkGreen|DarkKhaki|DarkMagenta|DarkOliveGreen|DarkOrange|DarkOrchid|DarkRed|DarkSalmon|DarkSeaGreen|DarkSlateBlue|DarkSlateGray|DarkSlateGrey|DarkTurquoise|DarkViolet|DeepPink|DeepSkyBlue|DimGray|DimGrey|DodgerBlue|FireBrick|FloralWhite|ForestGreen|Fuchsia|Gainsboro|GhostWhite|Gold|GoldenRod|Gray|Grey|Green|GreenYellow|HoneyDew|HotPink|IndianRed|Indigo|Ivory|Khaki|Lavender|LavenderBlush|LawnGreen|LemonChiffon|LightBlue|LightCoral|LightCyan|LightGoldenRodYellow|LightGray|LightGrey|LightGreen|LightPink|LightSalmon|LightSeaGreen|LightSkyBlue|LightSlateGray|LightSlateGrey|LightSteelBlue|LightYellow|Lime|LimeGreen|Linen|Magenta|Maroon|MediumAquaMarine|MediumBlue|MediumOrchid|MediumPurple|MediumSeaGreen|MediumSlateBlue|MediumSpringGreen|MediumTurquoise|MediumVioletRed|MidnightBlue|MintCream|MistyRose|Moccasin|NavajoWhite|Navy|OldLace|Olive|OliveDrab|Orange|OrangeRed|Orchid|PaleGoldenRod|PaleGreen|PaleTurquoise|PaleVioletRed|PapayaWhip|PeachPuff|Peru|Pink|Plum|PowderBlue|Purple|RebeccaPurple|Red|RosyBrown|RoyalBlue|SaddleBrown|Salmon|SandyBrown|SeaGreen|SeaShell|Sienna|Silver|SkyBlue|SlateBlue|SlateGray|SlateGrey|Snow|SpringGreen|SteelBlue|Tan|Teal|Thistle|Tomato|Turquoise|Violet|Wheat|White|WhiteSmoke|Yellow|YellowGreen)\b/gi);

                    const freshSwatchesContainer = currentAiToolWrapper.querySelector('#paletteSwatches');
                    if (colors && colors.length > 0 && freshSwatchesContainer) {
                        colors.slice(0, 5).forEach(color => {
                            const swatch = document.createElement('div');
                            swatch.style.width = '50px'; swatch.style.height = '50px'; swatch.style.backgroundColor = color;
                            swatch.style.border = '1px solid #ccc'; swatch.title = color;
                            freshSwatchesContainer.appendChild(swatch);
                        });
                        const textNode = document.createElement('div'); textNode.textContent = "Identified Colors: " + colors.join(', '); textNode.style.marginTop = '10px';
                        freshSwatchesContainer.appendChild(textNode);
                    } else if (freshSwatchesContainer) {
                        const textNode = document.createElement('div'); textNode.textContent = "Could not extract distinct color codes. AI Description: " + colorDescription;
                        freshSwatchesContainer.appendChild(textNode);
                    }
                } catch (error) { console.error("Color palette generation failed:", error); displayError('colorPaletteOutput', error); } 
                finally { hideSpinner('colorPaletteSpinner'); }
            }
        },
        {
            id: 'eli5Simplifier', title: 'ELI5 Text Simplifier', icon: 'fas fa-child',
            html: () => `
                <h3>25. "Explain Like I'm 5" Text Simplifier</h3>
                <label for="textToSimplify" class="block mb-2 text-sm font-medium">Paste complex text to simplify:</label>
                <textarea id="textToSimplify" rows="5" placeholder="Quantum entanglement is a physical phenomenon..." class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"></textarea>
                <button onclick="aiTool_simplifyEli5()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Simplify (ELI5)</button>
                <div class="spinner" id="eli5Spinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="eli5Output"></div>`,
            action: async function aiTool_simplifyEli5() {
                const text = currentAiToolWrapper.querySelector('#textToSimplify').value;
                if (!text) { alert("Please enter text to simplify."); return; }
                const prompt = `Explain the following text as if you were talking to a 5-year-old. Use simple words and analogies.\n\nText: "${text}"`;
                await callLlama3(prompt, 'eli5Spinner', 'eli5Output');
            }
        },
        {
            id: 'featureToBenefit', title: 'Feature to Benefit Converter', icon: 'fas fa-exchange-alt',
            html: () => `
                <h3>26. Product Feature to Benefit Converter</h3>
                <label for="productFeatures" class="block mb-2 text-sm font-medium">List product features (one per line):</label>
                <textarea id="productFeatures" rows="5" placeholder="e.g., Durable material\nLong battery life\nLightweight design" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"></textarea>
                <button onclick="aiTool_convertToBenefits()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Convert to Benefits</button>
                <div class="spinner" id="featureToBenefitSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="featureToBenefitOutput"></div>`,
            action: async function aiTool_convertToBenefits() {
                const features = currentAiToolWrapper.querySelector('#productFeatures').value;
                if (!features) { alert("Please list product features."); return; }
                const prompt = `For each product feature listed below, describe the primary benefit it provides to the customer. Focus on "what's in it for them".\n\nFeatures:\n${features}\n\nFormat as:\nFeature: [Feature]\nBenefit: [Benefit]`;
                await callLlama3(prompt, 'featureToBenefitSpinner', 'featureToBenefitOutput');
            }
        },
        {
            id: 'ctaGenerator', title: 'Call-to-Action Generator', icon: 'fas fa-mouse-pointer',
            html: () => `
                <h3>27. Call-to-Action (CTA) Generator</h3>
                <label for="ctaContext" class="block mb-2 text-sm font-medium">Describe content/goal for CTA:</label>
                <input type="text" id="ctaContext" placeholder="e.g., Sign up for newsletter about AI tools" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                <button onclick="aiTool_generateCtas()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Generate CTAs</button>
                <div class="spinner" id="ctaGeneratorSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="ctaGeneratorOutput"></div>`,
            action: async function aiTool_generateCtas() {
                const context = currentAiToolWrapper.querySelector('#ctaContext').value;
                if (!context) { alert("Please describe the content/goal for the CTA."); return; }
                const prompt = `Generate 3-5 compelling Call-to-Action (CTA) phrases related to: "${context}". Make them short, action-oriented, and persuasive.`;
                await callLlama3(prompt, 'ctaGeneratorSpinner', 'ctaGeneratorOutput');
            }
        },
        {
            id: 'hashtagGenerator', title: 'Hashtag Generator', icon: 'fas fa-hashtag',
            html: () => `
                <h3>28. Hashtag Generator</h3>
                <label for="hashtagInputText" class="block mb-2 text-sm font-medium">Enter text for hashtags (optional):</label>
                <input type="text" id="hashtagInputText" placeholder="e.g., My latest travel adventure in Paris" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                <label for="hashtagInputImage" class="block mt-3 mb-2 text-sm font-medium">Upload image for hashtags (optional):</label>
                <input type="file" id="hashtagInputImage" accept="image/*" onchange="imagePreview('hashtagInputImage', 'hashtagImagePreview')" class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 p-2">
                <img id="hashtagImagePreview" src="#" alt="Image preview" style="display:none; max-width: 200px; margin:10px 0;" class="rounded-md border"/>
                <button onclick="aiTool_generateHashtags()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Generate Hashtags</button>
                <div class="spinner" id="hashtagSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="hashtagOutput"></div>`,
            action: async function aiTool_generateHashtags() {
                const textInput = currentAiToolWrapper.querySelector('#hashtagInputText').value;
                const imageFileInput = currentAiToolWrapper.querySelector('#hashtagInputImage');
                if (!textInput && !imageFileInput.files.length) { alert("Please provide text or an image."); return; }
                
                const outputElement = currentAiToolWrapper.querySelector('#hashtagOutput');
                const previewImgHTML = currentAiToolWrapper.querySelector('#hashtagImagePreview').outerHTML;
                showSpinner('hashtagSpinner');
                if(outputElement) outputElement.innerHTML = previewImgHTML;

                let contextForHashtags = textInput || "";
                try {
                    if (imageFileInput.files.length > 0) {
                        const imageBase64 = await fileToBase64(imageFileInput.files[0]);
                        const visionResponse = await fetch("https://api.together.xyz/v1/chat/completions", {
                            method: "POST", headers: { "Authorization": `Bearer ${TOGETHER_API_KEY}`, "Content-Type": "application/json" },
                            body: JSON.stringify({ model: "meta-llama/Llama-Vision-Free", messages: [{ role: "user", content: [{ type: "image_url", image_url: { url: imageBase64 } }, { type: "text", text: "Describe the key elements and theme of this image for hashtag generation." }] }], max_tokens: 100 })
                        });
                        if (visionResponse.ok) {
                            const visionData = await visionResponse.json();
                            const imageDescription = visionData.choices?.[0]?.message?.content?.trim();
                            if (imageDescription) contextForHashtags += (contextForHashtags ? " " : "") + imageDescription;
                        }
                    }
                    if (!contextForHashtags) { displayError('hashtagOutput', "Could not get context for hashtags."); hideSpinner('hashtagSpinner'); return; }

                    const hashtagPrompt = `Based on the following context, generate a list of 10-15 relevant and effective hashtags (mix of popular and niche if appropriate): "${contextForHashtags}"`;
                    const llamaResponse = await fetch("https://api.together.xyz/v1/chat/completions", { 
                        method: "POST", headers: { "Authorization": `Bearer ${TOGETHER_API_KEY}`, "Content-Type": "application/json" },
                        body: JSON.stringify({ model: "meta-llama/Llama-3.3-70B-Instruct-Turbo-Free", messages: [{ role: "user", content: hashtagPrompt }], max_tokens: 150 })
                    });
                    if (!llamaResponse.ok) throw new Error('Llama 3 for hashtags failed');
                    const llamaData = await llamaResponse.json();
                    const hashtags = llamaData.choices?.[0]?.message?.content?.trim() || "No hashtags generated.";
                    
                    if(outputElement) { const textNode = document.createElement('div'); textNode.textContent = hashtags; outputElement.appendChild(textNode); }
                    else { displayOutput('hashtagOutput', hashtags); }

                } catch (error) { console.error("Hashtag generation failed:", error); displayError('hashtagOutput', error); } 
                finally { hideSpinner('hashtagSpinner'); }
            }
        },
        {
            id: 'intentSpotter', title: 'Intent Spotter', icon: 'fas fa-search-location',
            html: () => `
                <h3>29. Intent Spotter from Short Text</h3>
                <label for="textForIntent" class="block mb-2 text-sm font-medium">Enter short text to spot intent:</label>
                <input type="text" id="textForIntent" placeholder="e.g., How do I reset my password?" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                <button onclick="aiTool_spotIntent()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Spot Intent</button>
                <div class="spinner" id="intentSpotterSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="intentSpotterOutput"></div>`,
            action: async function aiTool_spotIntent() {
                const text = currentAiToolWrapper.querySelector('#textForIntent').value;
                if (!text) { alert("Please enter text to spot intent."); return; }
                await callDeepgramRead(text, { intents: true }, 'intentSpotterSpinner', 'intentSpotterOutput');
            }
        },
        {
            id: 'pollQuestionGenerator', title: 'Poll/Quiz Question Generator', icon: 'fas fa-poll',
            html: () => `
                <h3>30. Quick Poll/Quiz Question Generator</h3>
                <label for="pollTopic" class="block mb-2 text-sm font-medium">Topic for poll/quiz question:</label>
                <input type="text" id="pollTopic" placeholder="e.g., Favorite programming language" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                <label for="pollType" class="block mt-3 mb-2 text-sm font-medium">Type:</label>
                <select id="pollType" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                    <option value="poll">Poll Question</option> <option value="quiz">Quiz Question (with answer)</option>
                </select>
                <button onclick="aiTool_generatePollQuestion()" class="mt-4 text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Generate Question</button>
                <div class="spinner" id="pollQuestionSpinner"></div>
                <div class="output mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded-md" id="pollQuestionOutput"></div>`,
            action: async function aiTool_generatePollQuestion() {
                const topic = currentAiToolWrapper.querySelector('#pollTopic').value;
                const type = currentAiToolWrapper.querySelector('#pollType').value;
                if (!topic) { alert("Please enter a topic."); return; }
                let prompt = "";
                if (type === "poll") {
                    prompt = `Generate a single, engaging poll question about "${topic}" with 3-4 plausible answer options. Format as:\nQuestion: [Question]\nOptions:\n- [Option 1]\n- [Option 2]\n- [Option 3]`;
                } else { 
                    prompt = `Generate a single, interesting quiz question about "${topic}" with 3-4 plausible answer options, and clearly indicate the correct answer. Format as:\nQuestion: [Question]\nOptions:\n- [Option A]\n- [Option B]\n- [Option C]\nCorrect Answer: [Letter of correct option] - [Correct Option Text]`;
                }
                await callLlama3(prompt, 'pollQuestionSpinner', 'pollQuestionOutput');
            }
        }
    ];

    aiCreatorToolsDefinitions.forEach(toolDef => {
        if (toolDef.action && typeof toolDef.action === 'function') {
            window[toolDef.action.name] = toolDef.action;
        }
    });

    function populateAiCreatorSuiteNav() {
        const navContainer = document.getElementById('aiCreatorSuiteNavLinks');
        if (!navContainer) return;
        navContainer.innerHTML = ''; 
        const ul = document.createElement('ul');
        aiCreatorToolsDefinitions.forEach(tool => {
            const li = document.createElement('li');
            li.innerHTML = `<a href="#" class="ai-tool-nav-link" data-tool-id="${tool.id}"><i class="${tool.icon || 'fas fa-cogs'}"></i><span>${tool.title}</span></a>`;
            ul.appendChild(li);
        });
        navContainer.appendChild(ul);
    }

    function activateAiTool(toolId) {
        const toolDefinition = aiCreatorToolsDefinitions.find(t => t.id === toolId);
        if (!toolDefinition) {
            console.error("AI Tool definition not found:", toolId);
            return;
        }

        if (mainContentHeader && mainContentHeader.querySelector('h2')) {
            mainContentHeader.querySelector('h2').textContent = toolDefinition.title;
        }
        if (mainContentHeader && mainContentHeader.querySelector('p')) {
             mainContentHeader.querySelector('p').textContent = `Utilize the ${toolDefinition.title} below.`;
        }
        
        if(weConnectToolGrid) weConnectToolGrid.style.display = 'none';
        if(walletCard) walletCard.style.display = 'none'; 
        if(aiToolContentContainer) aiToolContentContainer.style.display = 'block';
        
        // Check if API keys are actual keys or placeholders for the notice
        if (TOGETHER_API_KEY === "144f137285e61f4f20c3af158629a0aaee85f131c8a48cd5ffdd0e6477898407" || DEEPGRAM_API_KEY === "5431a4360985a2cd68978b3b2908c13bca576830") {
             if(apiKeyNotice) apiKeyNotice.style.display = 'block';
        } else {
             if(apiKeyNotice) apiKeyNotice.style.display = 'none';
        }


        if(currentAiToolWrapper && typeof toolDefinition.html === 'function') {
            currentAiToolWrapper.innerHTML = toolDefinition.html();
        }

        document.querySelectorAll('.sidebar-nav a').forEach(l => l.classList.remove('active'));
        const activeLink = document.querySelector(`.sidebar-nav a[data-tool-id="${toolId}"], .sidebar-nav a[data-section="${toolId}"]`);
        if (activeLink) activeLink.classList.add('active');

        if (window.innerWidth <= 767 && sidebar && sidebar.classList.contains('open')) {
            sidebar.classList.remove('open');
        }
    }
    
    function showDashboardContent() {
        if (mainContentHeader && mainContentHeader.querySelector('h2')) {
            mainContentHeader.querySelector('h2').textContent = "Dashboard Tools";
        }
         if (mainContentHeader && mainContentHeader.querySelector('p')) {
            mainContentHeader.querySelector('p').textContent = "Explore our collection of AI-powered tools.";
        }

        if(aiToolContentContainer) aiToolContentContainer.style.display = 'none';
        if(apiKeyNotice) apiKeyNotice.style.display = 'none';
        if(weConnectToolGrid) weConnectToolGrid.style.display = 'grid'; 
        if(walletCard) walletCard.style.display = 'block';
        loadAndDisplayWeConnectTools();
    }


    document.addEventListener('DOMContentLoaded', () => {
        console.log('WeConnect App Initializing with AI Creator Suite...');
        
        initTheme(); 
        setInitialSidebarState();
        populateAiCreatorSuiteNav(); 
        showDashboardContent(); 

        const upgradeButton = document.querySelector('.btn-upgrade');
        if (upgradeButton) upgradeButton.addEventListener('click', () => alert('Upgrade clicked!'));
        
        document.querySelectorAll('.sidebar-nav a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                document.querySelectorAll('.sidebar-nav a').forEach(l => l.classList.remove('active'));
                this.classList.add('active');

                const toolId = this.dataset.toolId; 
                const sectionId = this.dataset.section; 

                if (toolId) { 
                    activateAiTool(toolId);
                } else if (sectionId) { 
                    if (sectionId === 'dashboard' || sectionId === 'all-weconnect-tools') {
                        showDashboardContent();
                    } else {
                        if (mainContentHeader && mainContentHeader.querySelector('h2')) {
                            mainContentHeader.querySelector('h2').textContent = this.querySelector('span')?.textContent || 'Section';
                        }
                        if(aiToolContentContainer) aiToolContentContainer.style.display = 'none';
                        if(apiKeyNotice) apiKeyNotice.style.display = 'none';
                        if(weConnectToolGrid) weConnectToolGrid.innerHTML = `<p>Content for ${this.querySelector('span')?.textContent || sectionId} will load here.</p>`;
                        if(walletCard) walletCard.style.display = 'block';
                    }
                    if (window.innerWidth <= 767 && sidebar && sidebar.classList.contains('open')) {
                        sidebar.classList.remove('open');
                    }
                }
            });
        });
        
        const initialDashboardLink = document.querySelector('.sidebar-nav a[data-section="dashboard"]');
        if(initialDashboardLink) initialDashboardLink.classList.add('active');

        if (auth.currentUser || !pageLoadingElement.classList.contains('hidden')) {
            setTimeout(() => {
                 if(pageLoadingElement && !pageLoadingElement.classList.contains('hidden') && auth.currentUser) {
                 } else if (pageLoadingElement && !pageLoadingElement.classList.contains('hidden') && !auth.currentUser) {
                    pageLoadingElement.classList.add('hidden'); 
                 }
            }, 700);
        }
    });
</script>

</body>
</html>